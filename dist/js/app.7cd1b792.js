(function(e){function t(t){for(var n,o,s=t[0],u=t[1],h=t[2],l=0,f=[];l<s.length;l++)o=s[l],Object.prototype.hasOwnProperty.call(i,o)&&i[o]&&f.push(i[o][0]),i[o]=0;for(n in u)Object.prototype.hasOwnProperty.call(u,n)&&(e[n]=u[n]);c&&c(t);while(f.length)f.shift()();return a.push.apply(a,h||[]),r()}function r(){for(var e,t=0;t<a.length;t++){for(var r=a[t],n=!0,s=1;s<r.length;s++){var u=r[s];0!==i[u]&&(n=!1)}n&&(a.splice(t--,1),e=o(o.s=r[0]))}return e}var n={},i={app:0},a=[];function o(t){if(n[t])return n[t].exports;var r=n[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,o),r.l=!0,r.exports}o.m=e,o.c=n,o.d=function(e,t,r){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(r,n,function(t){return e[t]}.bind(null,n));return r},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],u=s.push.bind(s);s.push=t,s=s.slice();for(var h=0;h<s.length;h++)t(s[h]);var c=u;a.push([0,"chunk-vendors"]),r()})({0:function(e,t,r){e.exports=r("56d7")},"0a9d":function(e,t,r){"use strict";r("a4d3"),r("e01a"),r("d28b"),r("a623"),r("d3b7"),r("3ca3"),r("ddb0"),r("96cf");var n=r("6374"),i=r("970b"),a=r("5bc3");Object.defineProperty(t,"__esModule",{value:!0}),t.Board=void 0;var o=r("4467"),s=r("825c"),u=function(){function e(){i(this,e)}return a(e,[{key:"reset",value:function(){this.occupied=new s.SquareSet(65535,4294901760),this.promoted=s.SquareSet.empty(),this.white=new s.SquareSet(65535,0),this.black=new s.SquareSet(0,4294901760),this.pawn=new s.SquareSet(65280,16711680),this.knight=new s.SquareSet(66,1107296256),this.bishop=new s.SquareSet(36,603979776),this.rook=new s.SquareSet(129,2164260864),this.queen=new s.SquareSet(8,134217728),this.king=new s.SquareSet(16,268435456)}},{key:"clear",value:function(){this.occupied=s.SquareSet.empty(),this.promoted=s.SquareSet.empty();var e,t=n(o.COLORS);try{for(t.s();!(e=t.n()).done;){var r=e.value;this[r]=s.SquareSet.empty()}}catch(h){t.e(h)}finally{t.f()}var i,a=n(o.ROLES);try{for(a.s();!(i=a.n()).done;){var u=i.value;this[u]=s.SquareSet.empty()}}catch(h){a.e(h)}finally{a.f()}}},{key:"clone",value:function(){var t=new e;t.occupied=this.occupied,t.promoted=this.promoted;var r,i=n(o.COLORS);try{for(i.s();!(r=i.n()).done;){var a=r.value;t[a]=this[a]}}catch(c){i.e(c)}finally{i.f()}var s,u=n(o.ROLES);try{for(u.s();!(s=u.n()).done;){var h=s.value;t[h]=this[h]}}catch(c){u.e(c)}finally{u.f()}return t}},{key:"equalsIgnorePromoted",value:function(e){var t=this;return!!this.white.equals(e.white)&&o.ROLES.every((function(r){return t[r].equals(e[r])}))}},{key:"equals",value:function(e){return this.equalsIgnorePromoted(e)&&this.promoted.equals(e.promoted)}},{key:"getColor",value:function(e){return this.white.has(e)?"white":this.black.has(e)?"black":void 0}},{key:"getRole",value:function(e){var t,r=n(o.ROLES);try{for(r.s();!(t=r.n()).done;){var i=t.value;if(this[i].has(e))return i}}catch(a){r.e(a)}finally{r.f()}}},{key:"get",value:function(e){var t=this.getColor(e);if(t){var r=this.getRole(e),n=this.promoted.has(e);return{color:t,role:r,promoted:n}}}},{key:"take",value:function(e){var t=this.get(e);return t&&(this.occupied=this.occupied.without(e),this[t.color]=this[t.color].without(e),this[t.role]=this[t.role].without(e),t.promoted&&(this.promoted=this.promoted.without(e))),t}},{key:"set",value:function(e,t){var r=this.take(e);return this.occupied=this.occupied.with(e),this[t.color]=this[t.color].with(e),this[t.role]=this[t.role].with(e),t.promoted&&(this.promoted=this.promoted.with(e)),r}},{key:"has",value:function(e){return this.occupied.has(e)}},{key:Symbol.iterator,value:regeneratorRuntime.mark((function e(){var t,r,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t=n(this.occupied),e.prev=1,t.s();case 3:if((r=t.n()).done){e.next=9;break}return i=r.value,e.next=7,[i,this.get(i)];case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e["catch"](1),t.e(e.t0);case 14:return e.prev=14,t.f(),e.finish(14);case 17:case"end":return e.stop()}}),e,this,[[1,11,14,17]])}))},{key:"pieces",value:function(e,t){return this[e].intersect(this[t])}},{key:"rooksAndQueens",value:function(){return this.rook.union(this.queen)}},{key:"bishopsAndQueens",value:function(){return this.bishop.union(this.queen)}},{key:"kingOf",value:function(e){return this.king.intersect(this[e]).diff(this.promoted).singleSquare()}}],[{key:"default",value:function(){var t=new e;return t.reset(),t}},{key:"racingKings",value:function(){var t=new e;return t.occupied=new s.SquareSet(65535,0),t.promoted=s.SquareSet.empty(),t.white=new s.SquareSet(61680,0),t.black=new s.SquareSet(3855,0),t.pawn=s.SquareSet.empty(),t.knight=new s.SquareSet(6168,0),t.bishop=new s.SquareSet(9252,0),t.rook=new s.SquareSet(16962,0),t.queen=new s.SquareSet(129,0),t.king=new s.SquareSet(33024,0),t}},{key:"horde",value:function(){var t=new e;return t.occupied=new s.SquareSet(4294967295,4294901862),t.promoted=s.SquareSet.empty(),t.white=new s.SquareSet(4294967295,102),t.black=new s.SquareSet(0,4294901760),t.pawn=new s.SquareSet(4294967295,16711782),t.knight=new s.SquareSet(0,1107296256),t.bishop=new s.SquareSet(0,603979776),t.rook=new s.SquareSet(0,2164260864),t.queen=new s.SquareSet(0,134217728),t.king=new s.SquareSet(0,268435456),t}},{key:"empty",value:function(){var t=new e;return t.clear(),t}}]),e}();t.Board=u},"22d3":function(e,t,r){"use strict";r("99af"),r("caad"),r("c975"),r("a15b"),r("d81d"),r("ac1f"),r("8a79"),r("2532"),r("38cf"),r("1276");var n=r("448a"),i=r("6374"),a=r("970b"),o=r("ed6d"),s=r("2d0d"),u=r("a128");Object.defineProperty(t,"__esModule",{value:!0}),t.makeFen=t.makeRemainingChecks=t.makeCastlingFen=t.makePockets=t.makePocket=t.makeBoardFen=t.makePiece=t.parsePiece=t.parseFen=t.parseRemainingChecks=t.parseCastlingFen=t.parsePockets=t.parseBoardFen=t.FenError=t.InvalidFen=t.EMPTY_FEN=t.EMPTY_EPD=t.EMPTY_BOARD_FEN=t.INITIAL_FEN=t.INITIAL_EPD=t.INITIAL_BOARD_FEN=void 0;var h,c=r("909b"),l=r("4467"),f=r("825c"),d=r("0a9d"),k=r("e27b"),p=r("987b");t.INITIAL_BOARD_FEN="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",t.INITIAL_EPD=t.INITIAL_BOARD_FEN+" w KQkq -",t.INITIAL_FEN=t.INITIAL_EPD+" 0 1",t.EMPTY_BOARD_FEN="8/8/8/8/8/8/8/8",t.EMPTY_EPD=t.EMPTY_BOARD_FEN+" w - -",t.EMPTY_FEN=t.EMPTY_EPD+" 0 1",function(e){e["Fen"]="ERR_FEN",e["Board"]="ERR_BOARD",e["Pockets"]="ERR_POCKETS",e["Turn"]="ERR_TURN",e["Castling"]="ERR_CASTLING",e["EpSquare"]="ERR_EP_SQUARE",e["RemainingChecks"]="ERR_REMAINING_CHECKS",e["Halfmoves"]="ERR_HALFMOVES",e["Fullmoves"]="ERR_FULLMOVES"}(h=t.InvalidFen||(t.InvalidFen={}));var v=function(e){o(r,e);var t=s(r);function r(){return a(this,r),t.apply(this,arguments)}return r}(u(Error));function S(e,t,r){var n=e.indexOf(t);while(r-- >0){if(-1===n)break;n=e.indexOf(t,n+t.length)}return n}function m(e){return/^\d{1,4}$/.test(e)?parseInt(e,10):void 0}function y(e){var t=p.charToRole(e);return t&&{role:t,color:e.toLowerCase()===e?"black":"white"}}function w(e){for(var t=d.Board.empty(),r=7,n=0,i=0;i<e.length;i++){var a=e[i];if("/"===a&&8===n)n=0,r--;else{var o=parseInt(a,10);if(o>0)n+=o;else{if(n>=8||r<0)return c.Result.err(new v(h.Board));var s=n+8*r,u=y(a);if(!u)return c.Result.err(new v(h.Board));"~"===e[i+1]&&(u.promoted=!0,i++),t.set(s,u),n++}}}return 0!==r||8!==n?c.Result.err(new v(h.Board)):c.Result.ok(t)}function b(e){if(e.length>64)return c.Result.err(new v(h.Pockets));var t,r=k.Material.empty(),n=i(e);try{for(n.s();!(t=n.n()).done;){var a=t.value,o=y(a);if(!o)return c.Result.err(new v(h.Pockets));r[o.color][o.role]++}}catch(s){n.e(s)}finally{n.f()}return c.Result.ok(r)}function q(e,t){var r=f.SquareSet.empty();if("-"===t)return c.Result.ok(r);if(!/^[KQABCDEFGH]{0,2}[kqabcdefgh]{0,2}$/.test(t))return c.Result.err(new v(h.Castling));var n,a=i(t);try{for(a.s();!(n=a.n()).done;){var o=n.value,s=o.toLowerCase(),u=o===s?"black":"white",l=f.SquareSet.backrank(u).intersect(e[u]),d=void 0;d="q"===s?l:"k"===s?l.reversed():f.SquareSet.fromSquare(s.charCodeAt(0)-"a".charCodeAt(0)).intersect(l);var k,p=i(d);try{for(p.s();!(k=p.n()).done;){var S=k.value;if(e.king.has(S)&&!e.promoted.has(S))break;if(e.rook.has(S)){r=r.with(S);break}}}catch(m){p.e(m)}finally{p.f()}}}catch(m){a.e(m)}finally{a.f()}return c.Result.ok(r)}function g(e){var t=e.split("+");if(3===t.length&&""===t[0]){var r=m(t[1]),n=m(t[2]);return!p.defined(r)||r>3||!p.defined(n)||n>3?c.Result.err(new v(h.RemainingChecks)):c.Result.ok(new k.RemainingChecks(3-r,3-n))}if(2===t.length){var i=m(t[0]),a=m(t[1]);return!p.defined(i)||i>3||!p.defined(a)||a>3?c.Result.err(new v(h.RemainingChecks)):c.Result.ok(new k.RemainingChecks(i,a))}return c.Result.err(new v(h.RemainingChecks))}function R(e){var t,r,n=e.split(" "),i=n.shift(),a=c.Result.ok(void 0);if(i.endsWith("]")){var o=i.indexOf("[");if(-1===o)return c.Result.err(new v(h.Fen));t=w(i.substr(0,o)),a=b(i.substr(o+1,i.length-1-o-1))}else{var s=S(i,"/",7);-1===s?t=w(i):(t=w(i.substr(0,s)),a=b(i.substr(s+1)))}var u=n.shift();if(p.defined(u)&&"w"!==u){if("b"!==u)return c.Result.err(new v(h.Turn));r="black"}else r="white";return t.chain((function(e){var t,i=n.shift(),o=p.defined(i)?q(e,i):c.Result.ok(f.SquareSet.empty()),s=n.shift();if(p.defined(s)&&"-"!==s&&(t=p.parseSquare(s),!p.defined(t)))return c.Result.err(new v(h.EpSquare));var u,l=n.shift();p.defined(l)&&l.includes("+")&&(u=g(l),l=n.shift());var d=p.defined(l)?m(l):0;if(!p.defined(d))return c.Result.err(new v(h.Halfmoves));var k=n.shift(),S=p.defined(k)?m(k):1;if(!p.defined(S))return c.Result.err(new v(h.Fullmoves));var y=n.shift(),w=c.Result.ok(void 0);if(p.defined(y)){if(p.defined(u))return c.Result.err(new v(h.RemainingChecks));w=g(y)}else p.defined(u)&&(w=u);return n.length>0?c.Result.err(new v(h.Fen)):a.chain((function(n){return o.chain((function(i){return w.map((function(a){return{board:e,pockets:n,turn:r,unmovedRooks:i,remainingChecks:a,epSquare:t,halfmoves:d,fullmoves:Math.max(1,S)}}))}))}))}))}function E(e){if(e){var t=y(e[0]);if(t){if(2===e.length&&"~"===e[1])t.promoted=!0;else if(e.length>1)return;return t}}}function P(e,t){var r=p.roleToChar(e.role);return"white"===e.color&&(r=r.toUpperCase()),(null===t||void 0===t?void 0:t.promoted)&&e.promoted&&(r+="~"),r}function C(e,t){for(var r="",n=0,i=7;i>=0;i--)for(var a=0;a<8;a++){var o=a+8*i,s=e.get(o);s?(n>0&&(r+=n,n=0),r+=P(s,t)):n++,7===a&&(n>0&&(r+=n,n=0),0!==i&&(r+="/"))}return r}function A(e){return l.ROLES.map((function(t){return p.roleToChar(t).repeat(e[t])})).join("")}function O(e){return A(e.white).toUpperCase()+A(e.black)}function _(e,t,r){var n,a=null===r||void 0===r?void 0:r.shredder,o="",s=i(l.COLORS);try{for(s.s();!(n=s.n()).done;){var u=n.value,h=f.SquareSet.backrank(u),c=e.kingOf(u);if(p.defined(c)&&h.has(c)){var d,k=e.pieces(u,"rook").intersect(h),v=i(t.intersect(k).reversed());try{for(v.s();!(d=v.n()).done;){var S=d.value;if(!a&&S===k.first()&&S<c)o+="white"===u?"Q":"q";else if(!a&&S===k.last()&&c<S)o+="white"===u?"K":"k";else{var m=l.FILE_NAMES[p.squareFile(S)];o+="white"===u?m.toUpperCase():m}}}catch(y){v.e(y)}finally{v.f()}}}}catch(y){s.e(y)}finally{s.f()}return o||"-"}function I(e){return"".concat(e.white,"+").concat(e.black)}function M(e,t){return[C(e.board,t)+(e.pockets?"[".concat(O(e.pockets),"]"):""),e.turn[0],_(e.board,e.unmovedRooks,t),p.defined(e.epSquare)?p.makeSquare(e.epSquare):"-"].concat(n(e.remainingChecks?[I(e.remainingChecks)]:[]),n((null===t||void 0===t?void 0:t.epd)?[]:[Math.max(0,Math.min(e.halfmoves,9999)),Math.max(1,Math.min(e.fullmoves,9999))])).join(" ")}t.FenError=v,t.parseBoardFen=w,t.parsePockets=b,t.parseCastlingFen=q,t.parseRemainingChecks=g,t.parseFen=R,t.parsePiece=E,t.makePiece=P,t.makeBoardFen=C,t.makePocket=A,t.makePockets=O,t.makeCastlingFen=_,t.makeRemainingChecks=I,t.makeFen=M},4467:function(e,t,r){"use strict";function n(e){return"role"in e}function i(e){return"from"in e}Object.defineProperty(t,"__esModule",{value:!0}),t.RULES=t.isNormal=t.isDrop=t.CASTLING_SIDES=t.ROLES=t.COLORS=t.RANK_NAMES=t.FILE_NAMES=void 0,t.FILE_NAMES=["a","b","c","d","e","f","g","h"],t.RANK_NAMES=["1","2","3","4","5","6","7","8"],t.COLORS=["white","black"],t.ROLES=["pawn","knight","bishop","rook","queen","king"],t.CASTLING_SIDES=["a","h"],t.isDrop=n,t.isNormal=i,t.RULES=["chess","antichess","kingofthehill","3check","atomic","horde","racingkings","crazyhouse"]},"56d7":function(e,t,r){"use strict";r.r(t);r("e260"),r("e6cf"),r("cca6"),r("a79d");var n=r("2b0e"),i=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{ref:"board",attrs:{id:"app"}},[r("input",{staticStyle:{display:"none"},attrs:{type:"text",id:"fen"}}),r("button",{staticStyle:{display:"none"},attrs:{id:"clickbutton"},on:{click:function(t){return e.setFen()}}}),r("chessboard",{attrs:{fen:e.currentFen}})],1)},a=[],o=r("66f9"),s=(r("1ec6"),{name:"app",components:{chessboard:o["chessboard"]},data:function(){return{currentFen:"",positionInfo:null}},methods:{showInfo:function(e){this.positionInfo=e},setFen:function(e){var t=document.getElementById("fen");e&&(t.value=e),this.currentFen=t.value},promote:function(){return confirm("Want to promote to rook? Queen by default")?"r":"q"}},created:function(){this.fens=["5rr1/3nqpk1/p3p2p/Pp1pP1pP/2pP1PN1/2P1Q3/2P3P1/R4RK1 b - f3 0 28","r4rk1/pp1b3p/6p1/8/3NpP2/1P4P1/P2K3P/R6R w - - 0 22"]}}),u=s,h=r("2877"),c=Object(h["a"])(u,i,a,!1,null,null,null),l=c.exports,f=(r("ebed"),r("22d3")),d=r("fb26"),k=r("987b");function p(e){document.getElementById("fen").value=e,document.getElementById("clickbutton").click()}new n["a"]({el:"#app",render:function(e){return e(l)}});var v="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";function S(e){var t=Object(f["parseFen"])(e).unwrap(),r=d["Chess"].fromSetup(t).unwrap();return r}function m(e){var t=Object(f["makeFen"])(e.toSetup(),null);return t}function y(e,t){var r=Object(k["parseUci"])(t);e.play(r)}p(v);var w=S(v);y(w,"e2e4"),p(m(w))},"825c":function(e,t,r){"use strict";r("a4d3"),r("e01a"),r("d28b"),r("40d9"),r("bc01"),r("d3b7"),r("3ca3"),r("ddb0"),r("96cf");var n=r("970b"),i=r("5bc3");function a(e){return e-=e>>>1&1431655765,e=(858993459&e)+(e>>>2&858993459),Math.imul(e+(e>>>4)&252645135,16843009)>>24}function o(e){return e=e>>>8&16711935|(16711935&e)<<8,e>>>16&65535|(65535&e)<<16}function s(e){return e=e>>>1&1431655765|(1431655765&e)<<1,e=e>>>2&858993459|(858993459&e)<<2,e=e>>>4&252645135|(252645135&e)<<4,o(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.SquareSet=void 0;var u=function(){function e(t,r){n(this,e),this.lo=t,this.hi=r,this.lo=0|t,this.hi=0|r}return i(e,[{key:"complement",value:function(){return new e(~this.lo,~this.hi)}},{key:"xor",value:function(t){return new e(this.lo^t.lo,this.hi^t.hi)}},{key:"union",value:function(t){return new e(this.lo|t.lo,this.hi|t.hi)}},{key:"intersect",value:function(t){return new e(this.lo&t.lo,this.hi&t.hi)}},{key:"diff",value:function(t){return new e(this.lo&~t.lo,this.hi&~t.hi)}},{key:"intersects",value:function(e){return this.intersect(e).nonEmpty()}},{key:"isDisjoint",value:function(e){return this.intersect(e).isEmpty()}},{key:"supersetOf",value:function(e){return e.diff(this).isEmpty()}},{key:"subsetOf",value:function(e){return this.diff(e).isEmpty()}},{key:"shr64",value:function(t){return t>=64?e.empty():t>=32?new e(this.hi>>>t-32,0):t>0?new e(this.lo>>>t^this.hi<<32-t,this.hi>>>t):this}},{key:"shl64",value:function(t){return t>=64?e.empty():t>=32?new e(0,this.lo<<t-32):t>0?new e(this.lo<<t,this.hi<<t^this.lo>>>32-t):this}},{key:"bswap64",value:function(){return new e(o(this.hi),o(this.lo))}},{key:"rbit64",value:function(){return new e(s(this.hi),s(this.lo))}},{key:"minus64",value:function(t){var r=this.lo-t.lo,n=(r&t.lo&1)+(t.lo>>>1)+(r>>>1)>>>31;return new e(r,this.hi-(t.hi+n))}},{key:"equals",value:function(e){return this.lo===e.lo&&this.hi===e.hi}},{key:"size",value:function(){return a(this.lo)+a(this.hi)}},{key:"isEmpty",value:function(){return 0===this.lo&&0===this.hi}},{key:"nonEmpty",value:function(){return 0!==this.lo||0!==this.hi}},{key:"has",value:function(e){return 0!==(e>=32?this.hi&1<<e-32:this.lo&1<<e)}},{key:"set",value:function(e,t){return t?this.with(e):this.without(e)}},{key:"with",value:function(t){return t>=32?new e(this.lo,this.hi|1<<t-32):new e(this.lo|1<<t,this.hi)}},{key:"without",value:function(t){return t>=32?new e(this.lo,this.hi&~(1<<t-32)):new e(this.lo&~(1<<t),this.hi)}},{key:"toggle",value:function(t){return t>=32?new e(this.lo,this.hi^1<<t-32):new e(this.lo^1<<t,this.hi)}},{key:"last",value:function(){return 0!==this.hi?63-Math.clz32(this.hi):0!==this.lo?31-Math.clz32(this.lo):void 0}},{key:"first",value:function(){return 0!==this.lo?31-Math.clz32(this.lo&-this.lo):0!==this.hi?63-Math.clz32(this.hi&-this.hi):void 0}},{key:"withoutFirst",value:function(){return 0!==this.lo?new e(this.lo&this.lo-1,this.hi):new e(0,this.hi&this.hi-1)}},{key:"moreThanOne",value:function(){return 0!==this.hi&&0!==this.lo||0!==(this.lo&this.lo-1)||0!==(this.hi&this.hi-1)}},{key:"singleSquare",value:function(){return this.moreThanOne()?void 0:this.last()}},{key:"isSingleSquare",value:function(){return this.nonEmpty()&&!this.moreThanOne()}},{key:Symbol.iterator,value:regeneratorRuntime.mark((function e(){var t,r,n,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t=this.lo,r=this.hi;case 2:if(0===t){e.next=9;break}return n=31-Math.clz32(t&-t),t^=1<<n,e.next=7,n;case 7:e.next=2;break;case 9:if(0===r){e.next=16;break}return i=31-Math.clz32(r&-r),r^=1<<i,e.next=14,32+i;case 14:e.next=9;break;case 16:case"end":return e.stop()}}),e,this)}))},{key:"reversed",value:regeneratorRuntime.mark((function e(){var t,r,n,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t=this.lo,r=this.hi;case 2:if(0===r){e.next=9;break}return n=31-Math.clz32(r),r^=1<<n,e.next=7,32+n;case 7:e.next=2;break;case 9:if(0===t){e.next=16;break}return i=31-Math.clz32(t),t^=1<<i,e.next=14,i;case 14:e.next=9;break;case 16:case"end":return e.stop()}}),e,this)}))}],[{key:"fromSquare",value:function(t){return t>=32?new e(0,1<<t-32):new e(1<<t,0)}},{key:"fromRank",value:function(t){return new e(255,0).shl64(8*t)}},{key:"fromFile",value:function(t){return new e(16843009<<t,16843009<<t)}},{key:"empty",value:function(){return new e(0,0)}},{key:"full",value:function(){return new e(4294967295,4294967295)}},{key:"corners",value:function(){return new e(129,2164260864)}},{key:"center",value:function(){return new e(402653184,24)}},{key:"backranks",value:function(){return new e(255,4278190080)}},{key:"backrank",value:function(t){return"white"===t?new e(255,0):new e(0,4278190080)}},{key:"lightSquares",value:function(){return new e(1437226410,1437226410)}},{key:"darkSquares",value:function(){return new e(2857740885,2857740885)}}]),e}();t.SquareSet=u},"987b":function(e,t,r){"use strict";r("99af"),r("fb6a"),Object.defineProperty(t,"__esModule",{value:!0}),t.makeUci=t.parseUci=t.makeSquare=t.parseSquare=t.charToRole=t.roleToChar=t.squareFile=t.squareRank=t.opposite=t.defined=void 0;var n=r("4467");function i(e){return void 0!==e}function a(e){return"white"===e?"black":"white"}function o(e){return e>>3}function s(e){return 7&e}function u(e){switch(e){case"pawn":return"p";case"knight":return"n";case"bishop":return"b";case"rook":return"r";case"queen":return"q";case"king":return"k"}}function h(e){switch(e){case"P":case"p":return"pawn";case"N":case"n":return"knight";case"B":case"b":return"bishop";case"R":case"r":return"rook";case"Q":case"q":return"queen";case"K":case"k":return"king";default:return}}function c(e){if(2===e.length){var t=e.charCodeAt(0)-"a".charCodeAt(0),r=e.charCodeAt(1)-"1".charCodeAt(0);if(!(t<0||t>=8||r<0||r>=8))return t+8*r}}function l(e){return n.FILE_NAMES[s(e)]+n.RANK_NAMES[o(e)]}function f(e){if("@"===e[1]&&4===e.length){var t=h(e[0]),r=c(e.slice(2));if(t&&i(r))return{role:t,to:r}}else if(4===e.length||5===e.length){var n,a=c(e.slice(0,2)),o=c(e.slice(2,4));if(5===e.length&&(n=h(e[4]),!n))return;if(i(a)&&i(o))return{from:a,to:o,promotion:n}}}function d(e){return n.isDrop(e)?"".concat(u(e.role).toUpperCase(),"@").concat(l(e.to)):l(e.from)+l(e.to)+(e.promotion?u(e.promotion):"")}t.defined=i,t.opposite=a,t.squareRank=o,t.squareFile=s,t.roleToChar=u,t.charToRole=h,t.parseSquare=c,t.makeSquare=l,t.parseUci=f,t.makeUci=d},b2d1:function(e,t,r){"use strict";var n=r("6374");Object.defineProperty(t,"__esModule",{value:!0}),t.between=t.ray=t.attacks=t.queenAttacks=t.rookAttacks=t.bishopAttacks=t.pawnAttacks=t.knightAttacks=t.kingAttacks=void 0;var i=r("987b"),a=r("825c");function o(e,t){var r,o=a.SquareSet.empty(),s=n(t);try{for(s.s();!(r=s.n()).done;){var u=r.value,h=e+u;0<=h&&h<64&&Math.abs(i.squareFile(e)-i.squareFile(h))<=2&&(o=o.with(h))}}catch(c){s.e(c)}finally{s.f()}return o}function s(e){for(var t=[],r=0;r<64;r++)t[r]=e(r);return t}var u=s((function(e){return o(e,[-9,-8,-7,-1,1,7,8,9])})),h=s((function(e){return o(e,[-17,-15,-10,-6,6,10,15,17])})),c={white:s((function(e){return o(e,[7,9])})),black:s((function(e){return o(e,[-7,-9])}))};function l(e){return u[e]}function f(e){return h[e]}function d(e,t){return c[e][t]}t.kingAttacks=l,t.knightAttacks=f,t.pawnAttacks=d;var k=s((function(e){return a.SquareSet.fromFile(i.squareFile(e)).without(e)})),p=s((function(e){return a.SquareSet.fromRank(i.squareRank(e)).without(e)})),v=s((function(e){var t=new a.SquareSet(134480385,2151686160),r=8*(i.squareRank(e)-i.squareFile(e));return(r>=0?t.shl64(r):t.shr64(-r)).without(e)})),S=s((function(e){var t=new a.SquareSet(270549120,16909320),r=8*(i.squareRank(e)+i.squareFile(e)-7);return(r>=0?t.shl64(r):t.shr64(-r)).without(e)}));function m(e,t,r){var n=r.intersect(t),i=n.bswap64();return n=n.minus64(e),i=i.minus64(e.bswap64()),n.xor(i.bswap64()).intersect(t)}function y(e,t){return m(a.SquareSet.fromSquare(e),k[e],t)}function w(e,t){var r=p[e],n=t.intersect(r),i=n.rbit64();return n=n.minus64(a.SquareSet.fromSquare(e)),i=i.minus64(a.SquareSet.fromSquare(63-e)),n.xor(i.rbit64()).intersect(r)}function b(e,t){var r=a.SquareSet.fromSquare(e);return m(r,v[e],t).xor(m(r,S[e],t))}function q(e,t){return y(e,t).xor(w(e,t))}function g(e,t){return b(e,t).xor(q(e,t))}function R(e,t,r){switch(e.role){case"pawn":return d(e.color,t);case"knight":return f(t);case"bishop":return b(t,r);case"rook":return q(t,r);case"queen":return g(t,r);case"king":return l(t)}}function E(e,t){var r=a.SquareSet.fromSquare(t);return p[e].intersects(r)?p[e].with(e):S[e].intersects(r)?S[e].with(e):v[e].intersects(r)?v[e].with(e):k[e].intersects(r)?k[e].with(e):a.SquareSet.empty()}function P(e,t){return E(e,t).intersect(a.SquareSet.full().shl64(e).xor(a.SquareSet.full().shl64(t))).withoutFirst()}t.bishopAttacks=b,t.rookAttacks=q,t.queenAttacks=g,t.attacks=R,t.ray=E,t.between=P},e27b:function(e,t,r){"use strict";r("a623"),r("45fc");var n=r("6374"),i=r("970b"),a=r("5bc3");Object.defineProperty(t,"__esModule",{value:!0}),t.defaultSetup=t.RemainingChecks=t.Material=t.MaterialSide=void 0;var o=r("4467"),s=r("825c"),u=r("0a9d"),h=function(){function e(){i(this,e)}return a(e,[{key:"clone",value:function(){var t,r=new e,i=n(o.ROLES);try{for(i.s();!(t=i.n()).done;){var a=t.value;r[a]=this[a]}}catch(s){i.e(s)}finally{i.f()}return r}},{key:"equals",value:function(e){var t=this;return o.ROLES.every((function(r){return t[r]===e[r]}))}},{key:"add",value:function(t){var r,i=new e,a=n(o.ROLES);try{for(a.s();!(r=a.n()).done;){var s=r.value;i[s]=this[s]+t[s]}}catch(u){a.e(u)}finally{a.f()}return i}},{key:"nonEmpty",value:function(){var e=this;return o.ROLES.some((function(t){return e[t]>0}))}},{key:"isEmpty",value:function(){return!this.nonEmpty()}},{key:"hasPawns",value:function(){return this.pawn>0}},{key:"hasNonPawns",value:function(){return this.knight>0||this.bishop>0||this.rook>0||this.queen>0||this.king>0}},{key:"count",value:function(){return this.pawn+this.knight+this.bishop+this.rook+this.queen+this.king}}],[{key:"empty",value:function(){var t,r=new e,i=n(o.ROLES);try{for(i.s();!(t=i.n()).done;){var a=t.value;r[a]=0}}catch(s){i.e(s)}finally{i.f()}return r}},{key:"fromBoard",value:function(t,r){var i,a=new e,s=n(o.ROLES);try{for(s.s();!(i=s.n()).done;){var u=i.value;a[u]=t.pieces(r,u).size()}}catch(h){s.e(h)}finally{s.f()}return a}}]),e}();t.MaterialSide=h;var c=function(){function e(t,r){i(this,e),this.white=t,this.black=r}return a(e,[{key:"clone",value:function(){return new e(this.white.clone(),this.black.clone())}},{key:"equals",value:function(e){return this.white.equals(e.white)&&this.black.equals(e.black)}},{key:"add",value:function(t){return new e(this.white.add(t.white),this.black.add(t.black))}},{key:"count",value:function(){return this.white.count()+this.black.count()}},{key:"isEmpty",value:function(){return this.white.isEmpty()&&this.black.isEmpty()}},{key:"nonEmpty",value:function(){return!this.isEmpty()}},{key:"hasPawns",value:function(){return this.white.hasPawns()||this.black.hasPawns()}},{key:"hasNonPawns",value:function(){return this.white.hasNonPawns()||this.black.hasNonPawns()}}],[{key:"empty",value:function(){return new e(h.empty(),h.empty())}},{key:"fromBoard",value:function(t){return new e(h.fromBoard(t,"white"),h.fromBoard(t,"black"))}}]),e}();t.Material=c;var l=function(){function e(t,r){i(this,e),this.white=t,this.black=r}return a(e,[{key:"clone",value:function(){return new e(this.white,this.black)}},{key:"equals",value:function(e){return this.white===e.white&&this.black===e.black}}],[{key:"default",value:function(){return new e(3,3)}}]),e}();function f(){return{board:u.Board.default(),pockets:void 0,turn:"white",unmovedRooks:s.SquareSet.corners(),epSquare:void 0,remainingChecks:void 0,halfmoves:0,fullmoves:1}}t.RemainingChecks=l,t.defaultSetup=f},ebed:function(e,t,r){},fb26:function(e,t,r){"use strict";r("a623"),r("d81d"),r("4ec9"),r("d3b7"),r("3ca3"),r("ddb0");var n=r("8962"),i=r("36c6"),a=r("6374"),o=r("5bc3"),s=r("970b"),u=r("ed6d"),h=r("2d0d"),c=r("a128");Object.defineProperty(t,"__esModule",{value:!0}),t.Chess=t.Position=t.Castles=t.PositionError=t.IllegalSetup=void 0;var l,f=r("909b"),d=r("4467"),k=r("825c"),p=r("0a9d"),v=r("b2d1"),S=r("987b");(function(e){e["Empty"]="ERR_EMPTY",e["OppositeCheck"]="ERR_OPPOSITE_CHECK",e["ImpossibleCheck"]="ERR_IMPOSSIBLE_CHECK",e["PawnsOnBackrank"]="ERR_PAWNS_ON_BACKRANK",e["Kings"]="ERR_KINGS",e["Variant"]="ERR_VARIANT"})(l=t.IllegalSetup||(t.IllegalSetup={}));var m=function(e){u(r,e);var t=h(r);function r(){return s(this,r),t.apply(this,arguments)}return r}(c(Error));function y(e,t,r,n){return r[t].intersect(v.rookAttacks(e,n).intersect(r.rooksAndQueens()).union(v.bishopAttacks(e,n).intersect(r.bishopsAndQueens())).union(v.knightAttacks(e).intersect(r.knight)).union(v.kingAttacks(e).intersect(r.king)).union(v.pawnAttacks(S.opposite(t),e).intersect(r.pawn)))}function w(e,t){return"white"===e?"a"===t?2:6:"a"===t?58:62}function b(e,t){return"white"===e?"a"===t?3:5:"a"===t?59:61}t.PositionError=m;var q=function(){function e(){s(this,e)}return o(e,[{key:"clone",value:function(){var t=new e;return t.unmovedRooks=this.unmovedRooks,t.rook={white:{a:this.rook.white.a,h:this.rook.white.h},black:{a:this.rook.black.a,h:this.rook.black.h}},t.path={white:{a:this.path.white.a,h:this.path.white.h},black:{a:this.path.black.a,h:this.path.black.h}},t}},{key:"add",value:function(e,t,r,n){var i=w(e,t),a=b(e,t);this.unmovedRooks=this.unmovedRooks.with(n),this.rook[e][t]=n,this.path[e][t]=v.between(n,a).with(a).union(v.between(r,i).with(i)).without(r).without(n)}},{key:"discardRook",value:function(e){if(this.unmovedRooks.has(e)){this.unmovedRooks=this.unmovedRooks.without(e);var t,r=a(d.COLORS);try{for(r.s();!(t=r.n()).done;){var n,i=t.value,o=a(d.CASTLING_SIDES);try{for(o.s();!(n=o.n()).done;){var s=n.value;this.rook[i][s]===e&&(this.rook[i][s]=void 0)}}catch(u){o.e(u)}finally{o.f()}}}catch(u){r.e(u)}finally{r.f()}}}},{key:"discardSide",value:function(e){this.unmovedRooks=this.unmovedRooks.diff(k.SquareSet.backrank(e)),this.rook[e].a=void 0,this.rook[e].h=void 0}}],[{key:"default",value:function(){var t=new e;return t.unmovedRooks=k.SquareSet.corners(),t.rook={white:{a:0,h:7},black:{a:56,h:63}},t.path={white:{a:new k.SquareSet(14,0),h:new k.SquareSet(96,0)},black:{a:new k.SquareSet(0,234881024),h:new k.SquareSet(0,1610612736)}},t}},{key:"empty",value:function(){var t=new e;return t.unmovedRooks=k.SquareSet.empty(),t.rook={white:{a:void 0,h:void 0},black:{a:void 0,h:void 0}},t.path={white:{a:k.SquareSet.empty(),h:k.SquareSet.empty()},black:{a:k.SquareSet.empty(),h:k.SquareSet.empty()}},t}},{key:"fromSetup",value:function(t){var r,n=e.empty(),i=t.unmovedRooks.intersect(t.board.rook),o=a(d.COLORS);try{for(o.s();!(r=o.n()).done;){var s=r.value,u=k.SquareSet.backrank(s),h=t.board.kingOf(s);if(S.defined(h)&&u.has(h)){var c=i.intersect(t.board[s]).intersect(u),l=c.first();S.defined(l)&&l<h&&n.add(s,"a",h,l);var f=c.last();S.defined(f)&&h<f&&n.add(s,"h",h,f)}}}catch(p){o.e(p)}finally{o.f()}return n}}]),e}();t.Castles=q;var g=function(){function e(t){s(this,e),this.rules=t}return o(e,[{key:"kingAttackers",value:function(e,t,r){return y(e,t,this.board,r)}},{key:"dropDests",value:function(e){return k.SquareSet.empty()}},{key:"playCaptureAt",value:function(e,t){this.halfmoves=0,"rook"===t.role&&this.castles.discardRook(e),this.pockets&&this.pockets[S.opposite(t.color)][t.role]++}},{key:"ctx",value:function(){var e=this.isVariantEnd(),t=this.board.kingOf(this.turn);if(!S.defined(t))return{king:t,blockers:k.SquareSet.empty(),checkers:k.SquareSet.empty(),variantEnd:e,mustCapture:!1};var r,n=v.rookAttacks(t,k.SquareSet.empty()).intersect(this.board.rooksAndQueens()).union(v.bishopAttacks(t,k.SquareSet.empty()).intersect(this.board.bishopsAndQueens())).intersect(this.board[S.opposite(this.turn)]),i=k.SquareSet.empty(),o=a(n);try{for(o.s();!(r=o.n()).done;){var s=r.value,u=v.between(t,s).intersect(this.board.occupied);u.moreThanOne()||(i=i.union(u))}}catch(c){o.e(c)}finally{o.f()}var h=this.kingAttackers(t,S.opposite(this.turn),this.board.occupied);return{king:t,blockers:i,checkers:h,variantEnd:e,mustCapture:!1}}},{key:"clone",value:function(){var e,t,r=new this.constructor;return r.board=this.board.clone(),r.pockets=null===(e=this.pockets)||void 0===e?void 0:e.clone(),r.turn=this.turn,r.castles=this.castles.clone(),r.epSquare=this.epSquare,r.remainingChecks=null===(t=this.remainingChecks)||void 0===t?void 0:t.clone(),r.halfmoves=this.halfmoves,r.fullmoves=this.fullmoves,r}},{key:"equalsIgnoreMoves",value:function(e){var t,r;return this.rules===e.rules&&(this.pockets?this.board.equals(e.board):this.board.equalsIgnorePromoted(e.board))&&(e.pockets&&(null===(t=this.pockets)||void 0===t?void 0:t.equals(e.pockets))||!this.pockets&&!e.pockets)&&this.turn===e.turn&&this.castles.unmovedRooks.equals(e.castles.unmovedRooks)&&this.legalEpSquare()===e.legalEpSquare()&&(e.remainingChecks&&(null===(r=this.remainingChecks)||void 0===r?void 0:r.equals(e.remainingChecks))||!this.remainingChecks&&!e.remainingChecks)}},{key:"toSetup",value:function(){var e,t;return{board:this.board.clone(),pockets:null===(e=this.pockets)||void 0===e?void 0:e.clone(),turn:this.turn,unmovedRooks:this.castles.unmovedRooks,epSquare:this.legalEpSquare(),remainingChecks:null===(t=this.remainingChecks)||void 0===t?void 0:t.clone(),halfmoves:Math.min(this.halfmoves,150),fullmoves:Math.min(Math.max(this.fullmoves,1),9999)}}},{key:"isInsufficientMaterial",value:function(){var e=this;return d.COLORS.every((function(t){return e.hasInsufficientMaterial(t)}))}},{key:"hasDests",value:function(e){e=e||this.ctx();var t,r=a(this.board[this.turn]);try{for(r.s();!(t=r.n()).done;){var n=t.value;if(this.dests(n,e).nonEmpty())return!0}}catch(i){r.e(i)}finally{r.f()}return this.dropDests(e).nonEmpty()}},{key:"isLegal",value:function(e,t){if(d.isDrop(e))return!(!this.pockets||this.pockets[this.turn][e.role]<=0)&&(("pawn"!==e.role||!k.SquareSet.backranks().has(e.to))&&this.dropDests(t).has(e.to));if("pawn"===e.promotion)return!1;if("king"===e.promotion&&"antichess"!==this.rules)return!1;if(!!e.promotion!==(this.board.pawn.has(e.from)&&k.SquareSet.backranks().has(e.to)))return!1;var r=this.dests(e.from,t);return r.has(e.to)||r.has(this.normalizeMove(e).to)}},{key:"isCheck",value:function(){var e=this.board.kingOf(this.turn);return S.defined(e)&&this.kingAttackers(e,S.opposite(this.turn),this.board.occupied).nonEmpty()}},{key:"isEnd",value:function(e){return!!(e?e.variantEnd:this.isVariantEnd())||(this.isInsufficientMaterial()||!this.hasDests(e))}},{key:"isCheckmate",value:function(e){return e=e||this.ctx(),!e.variantEnd&&e.checkers.nonEmpty()&&!this.hasDests(e)}},{key:"isStalemate",value:function(e){return e=e||this.ctx(),!e.variantEnd&&e.checkers.isEmpty()&&!this.hasDests(e)}},{key:"outcome",value:function(e){var t=this.variantOutcome(e);return t||(e=e||this.ctx(),this.isCheckmate(e)?{winner:S.opposite(this.turn)}:this.isInsufficientMaterial()||this.isStalemate(e)?{winner:void 0}:void 0)}},{key:"allDests",value:function(e){e=e||this.ctx();var t=new Map;if(e.variantEnd)return t;var r,n=a(this.board[this.turn]);try{for(n.s();!(r=n.n()).done;){var i=r.value;t.set(i,this.dests(i,e))}}catch(o){n.e(o)}finally{n.f()}return t}},{key:"castlingSide",value:function(e){if(!d.isDrop(e)){var t=e.to-e.from;if((2===Math.abs(t)||this.board[this.turn].has(e.to))&&this.board.king.has(e.from))return t>0?"h":"a"}}},{key:"normalizeMove",value:function(e){var t=this.castlingSide(e);if(!t)return e;var r=this.castles.rook[this.turn][t];return{from:e.from,to:S.defined(r)?r:e.to}}},{key:"play",value:function(e){var t=this.turn,r=this.epSquare,n=this.castlingSide(e);if(this.epSquare=void 0,this.halfmoves+=1,"black"===t&&(this.fullmoves+=1),this.turn=S.opposite(t),d.isDrop(e))this.board.set(e.to,{role:e.role,color:t}),this.pockets&&this.pockets[t][e.role]--,"pawn"===e.role&&(this.halfmoves=0);else{var i,a=this.board.take(e.from);if(!a)return;if("pawn"===a.role){this.halfmoves=0,e.to===r&&(i=this.board.take(e.to+("white"===t?-8:8)));var o=e.from-e.to;16===Math.abs(o)&&8<=e.from&&e.from<=55&&(this.epSquare=e.from+e.to>>1),e.promotion&&(a.role=e.promotion,a.promoted=!0)}else if("rook"===a.role)this.castles.discardRook(e.from);else if("king"===a.role){if(n){var s=this.castles.rook[t][n];if(S.defined(s)){var u=this.board.take(s);this.board.set(w(t,n),a),u&&this.board.set(b(t,n),u)}}if(this.castles.discardSide(t),n)return}var h=this.board.set(e.to,a)||i;h&&this.playCaptureAt(e.to,h)}}},{key:"legalEpSquare",value:function(e){if(S.defined(this.epSquare)){e=e||this.ctx();var t,r=this.board.pieces(this.turn,"pawn"),n=r.intersect(v.pawnAttacks(S.opposite(this.turn),this.epSquare)),i=a(n);try{for(i.s();!(t=i.n()).done;){var o=t.value;if(this.dests(o,e).has(this.epSquare))return this.epSquare}}catch(s){i.e(s)}finally{i.f()}}}}]),e}();t.Position=g;var R=function(e){u(r,e);var t=h(r);function r(e){return s(this,r),t.call(this,e||"chess")}return o(r,[{key:"clone",value:function(){return n(i(r.prototype),"clone",this).call(this)}},{key:"validate",value:function(){if(this.board.occupied.isEmpty())return f.Result.err(new m(l.Empty));if(2!==this.board.king.size())return f.Result.err(new m(l.Kings));if(!S.defined(this.board.kingOf(this.turn)))return f.Result.err(new m(l.Kings));var e=this.board.kingOf(S.opposite(this.turn));return S.defined(e)?this.kingAttackers(e,this.turn,this.board.occupied).nonEmpty()?f.Result.err(new m(l.OppositeCheck)):k.SquareSet.backranks().intersects(this.board.pawn)?f.Result.err(new m(l.PawnsOnBackrank)):this.validateCheckers():f.Result.err(new m(l.Kings))}},{key:"validateCheckers",value:function(){var e=this.board.kingOf(this.turn);if(S.defined(e)){var t=this.kingAttackers(e,S.opposite(this.turn),this.board.occupied);if(t.size()>2||2===t.size()&&v.ray(t.first(),t.last()).has(e))return f.Result.err(new m(l.ImpossibleCheck));if(S.defined(this.epSquare)){var r,n=a(t);try{for(n.s();!(r=n.n()).done;){var i=r.value;if(v.ray(i,this.epSquare).has(e))return f.Result.err(new m(l.ImpossibleCheck))}}catch(o){n.e(o)}finally{n.f()}}}return f.Result.ok(void 0)}},{key:"validEpSquare",value:function(e){if(S.defined(e)){var t="white"===this.turn?5:2,r="white"===this.turn?8:-8;if(S.squareRank(e)===t&&!this.board.occupied.has(e+r)){var n=e-r;if(this.board.pawn.has(n)&&this.board[S.opposite(this.turn)].has(n))return e}}}},{key:"castlingDest",value:function(e,t){if(!S.defined(t.king)||t.checkers.nonEmpty())return k.SquareSet.empty();var r=this.castles.rook[this.turn][e];if(!S.defined(r))return k.SquareSet.empty();if(this.castles.path[this.turn][e].intersects(this.board.occupied))return k.SquareSet.empty();var n,i=w(this.turn,e),o=v.between(t.king,i),s=this.board.occupied.without(t.king),u=a(o);try{for(u.s();!(n=u.n()).done;){var h=n.value;if(this.kingAttackers(h,S.opposite(this.turn),s).nonEmpty())return k.SquareSet.empty()}}catch(f){u.e(f)}finally{u.f()}var c=b(this.turn,e),l=this.board.occupied.toggle(t.king).toggle(r).toggle(c);return this.kingAttackers(i,S.opposite(this.turn),l).nonEmpty()?k.SquareSet.empty():k.SquareSet.fromSquare(r)}},{key:"canCaptureEp",value:function(e,t){if(!S.defined(this.epSquare))return!1;if(!v.pawnAttacks(this.turn,e).has(this.epSquare))return!1;if(!S.defined(t.king))return!0;var r=this.epSquare+("white"===this.turn?-8:8),n=this.board.occupied.toggle(e).toggle(this.epSquare).toggle(r);return!this.kingAttackers(t.king,S.opposite(this.turn),n).intersects(n)}},{key:"pseudoDests",value:function(e,t){if(t.variantEnd)return k.SquareSet.empty();var r=this.board.get(e);if(!r||r.color!==this.turn)return k.SquareSet.empty();var n=v.attacks(r,e,this.board.occupied);if("pawn"===r.role){var i=this.board[S.opposite(this.turn)];S.defined(this.epSquare)&&(i=i.with(this.epSquare)),n=n.intersect(i);var a="white"===this.turn?8:-8,o=e+a;if(0<=o&&o<64&&!this.board.occupied.has(o)){n=n.with(o);var s="white"===this.turn?e<16:e>=48,u=o+a;s&&!this.board.occupied.has(u)&&(n=n.with(u))}return n}return n=n.diff(this.board[this.turn]),e===t.king?n.union(this.castlingDest("a",t)).union(this.castlingDest("h",t)):n}},{key:"dests",value:function(e,t){if(t=t||this.ctx(),t.variantEnd)return k.SquareSet.empty();var r,n,i=this.board.get(e);if(!i||i.color!==this.turn)return k.SquareSet.empty();if("pawn"===i.role){r=v.pawnAttacks(this.turn,e).intersect(this.board[S.opposite(this.turn)]);var o="white"===this.turn?8:-8,s=e+o;if(0<=s&&s<64&&!this.board.occupied.has(s)){r=r.with(s);var u="white"===this.turn?e<16:e>=48,h=s+o;u&&!this.board.occupied.has(h)&&(r=r.with(h))}if(S.defined(this.epSquare)&&this.canCaptureEp(e,t)){var c=this.epSquare-o;(t.checkers.isEmpty()||t.checkers.singleSquare()===c)&&(n=k.SquareSet.fromSquare(this.epSquare))}}else r="bishop"===i.role?v.bishopAttacks(e,this.board.occupied):"knight"===i.role?v.knightAttacks(e):"rook"===i.role?v.rookAttacks(e,this.board.occupied):"queen"===i.role?v.queenAttacks(e,this.board.occupied):v.kingAttacks(e);if(r=r.diff(this.board[this.turn]),S.defined(t.king)){if("king"===i.role){var l,f=this.board.occupied.without(e),d=a(r);try{for(d.s();!(l=d.n()).done;){var p=l.value;this.kingAttackers(p,S.opposite(this.turn),f).nonEmpty()&&(r=r.without(p))}}catch(y){d.e(y)}finally{d.f()}return r.union(this.castlingDest("a",t)).union(this.castlingDest("h",t))}if(t.checkers.nonEmpty()){var m=t.checkers.singleSquare();if(!S.defined(m))return k.SquareSet.empty();r=r.intersect(v.between(m,t.king).with(m))}t.blockers.has(e)&&(r=r.intersect(v.ray(e,t.king)))}return n&&(r=r.union(n)),r}},{key:"isVariantEnd",value:function(){return!1}},{key:"variantOutcome",value:function(e){}},{key:"hasInsufficientMaterial",value:function(e){if(this.board[e].intersect(this.board.pawn.union(this.board.rooksAndQueens())).nonEmpty())return!1;if(this.board[e].intersects(this.board.knight))return this.board[e].size()<=2&&this.board[S.opposite(e)].diff(this.board.king).diff(this.board.queen).isEmpty();if(this.board[e].intersects(this.board.bishop)){var t=!this.board.bishop.intersects(k.SquareSet.darkSquares())||!this.board.bishop.intersects(k.SquareSet.lightSquares());return t&&this.board.pawn.isEmpty()&&this.board.knight.isEmpty()}return!0}}],[{key:"default",value:function(){var e=new this;return e.board=p.Board.default(),e.pockets=void 0,e.turn="white",e.castles=q.default(),e.epSquare=void 0,e.remainingChecks=void 0,e.halfmoves=0,e.fullmoves=1,e}},{key:"fromSetup",value:function(e){var t=new this;return t.board=e.board.clone(),t.pockets=void 0,t.turn=e.turn,t.castles=q.fromSetup(e),t.epSquare=t.validEpSquare(e.epSquare),t.remainingChecks=void 0,t.halfmoves=e.halfmoves,t.fullmoves=e.fullmoves,t.validate().map((function(e){return t}))}}]),r}(g);t.Chess=R}});
//# sourceMappingURL=app.7cd1b792.js.map