(function(e){function t(t){for(var r,o,s=t[0],u=t[1],c=t[2],l=0,f=[];l<s.length;l++)o=s[l],Object.prototype.hasOwnProperty.call(i,o)&&i[o]&&f.push(i[o][0]),i[o]=0;for(r in u)Object.prototype.hasOwnProperty.call(u,r)&&(e[r]=u[r]);h&&h(t);while(f.length)f.shift()();return a.push.apply(a,c||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],r=!0,s=1;s<n.length;s++){var u=n[s];0!==i[u]&&(r=!1)}r&&(a.splice(t--,1),e=o(o.s=n[0]))}return e}var r={},i={app:0},a=[];function o(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=r,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(n,r,function(t){return e[t]}.bind(null,r));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],u=s.push.bind(s);s.push=t,s=s.slice();for(var c=0;c<s.length;c++)t(s[c]);var h=u;a.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"0a9d":function(e,t,n){"use strict";n("a4d3"),n("e01a"),n("d28b"),n("a623"),n("d3b7"),n("3ca3"),n("ddb0"),n("96cf");var r=n("6374"),i=n("970b"),a=n("5bc3");Object.defineProperty(t,"__esModule",{value:!0}),t.Board=void 0;var o=n("4467"),s=n("825c"),u=function(){function e(){i(this,e)}return a(e,[{key:"reset",value:function(){this.occupied=new s.SquareSet(65535,4294901760),this.promoted=s.SquareSet.empty(),this.white=new s.SquareSet(65535,0),this.black=new s.SquareSet(0,4294901760),this.pawn=new s.SquareSet(65280,16711680),this.knight=new s.SquareSet(66,1107296256),this.bishop=new s.SquareSet(36,603979776),this.rook=new s.SquareSet(129,2164260864),this.queen=new s.SquareSet(8,134217728),this.king=new s.SquareSet(16,268435456)}},{key:"clear",value:function(){this.occupied=s.SquareSet.empty(),this.promoted=s.SquareSet.empty();var e,t=r(o.COLORS);try{for(t.s();!(e=t.n()).done;){var n=e.value;this[n]=s.SquareSet.empty()}}catch(c){t.e(c)}finally{t.f()}var i,a=r(o.ROLES);try{for(a.s();!(i=a.n()).done;){var u=i.value;this[u]=s.SquareSet.empty()}}catch(c){a.e(c)}finally{a.f()}}},{key:"clone",value:function(){var t=new e;t.occupied=this.occupied,t.promoted=this.promoted;var n,i=r(o.COLORS);try{for(i.s();!(n=i.n()).done;){var a=n.value;t[a]=this[a]}}catch(h){i.e(h)}finally{i.f()}var s,u=r(o.ROLES);try{for(u.s();!(s=u.n()).done;){var c=s.value;t[c]=this[c]}}catch(h){u.e(h)}finally{u.f()}return t}},{key:"equalsIgnorePromoted",value:function(e){var t=this;return!!this.white.equals(e.white)&&o.ROLES.every((function(n){return t[n].equals(e[n])}))}},{key:"equals",value:function(e){return this.equalsIgnorePromoted(e)&&this.promoted.equals(e.promoted)}},{key:"getColor",value:function(e){return this.white.has(e)?"white":this.black.has(e)?"black":void 0}},{key:"getRole",value:function(e){var t,n=r(o.ROLES);try{for(n.s();!(t=n.n()).done;){var i=t.value;if(this[i].has(e))return i}}catch(a){n.e(a)}finally{n.f()}}},{key:"get",value:function(e){var t=this.getColor(e);if(t){var n=this.getRole(e),r=this.promoted.has(e);return{color:t,role:n,promoted:r}}}},{key:"take",value:function(e){var t=this.get(e);return t&&(this.occupied=this.occupied.without(e),this[t.color]=this[t.color].without(e),this[t.role]=this[t.role].without(e),t.promoted&&(this.promoted=this.promoted.without(e))),t}},{key:"set",value:function(e,t){var n=this.take(e);return this.occupied=this.occupied.with(e),this[t.color]=this[t.color].with(e),this[t.role]=this[t.role].with(e),t.promoted&&(this.promoted=this.promoted.with(e)),n}},{key:"has",value:function(e){return this.occupied.has(e)}},{key:Symbol.iterator,value:regeneratorRuntime.mark((function e(){var t,n,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t=r(this.occupied),e.prev=1,t.s();case 3:if((n=t.n()).done){e.next=9;break}return i=n.value,e.next=7,[i,this.get(i)];case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e["catch"](1),t.e(e.t0);case 14:return e.prev=14,t.f(),e.finish(14);case 17:case"end":return e.stop()}}),e,this,[[1,11,14,17]])}))},{key:"pieces",value:function(e,t){return this[e].intersect(this[t])}},{key:"rooksAndQueens",value:function(){return this.rook.union(this.queen)}},{key:"bishopsAndQueens",value:function(){return this.bishop.union(this.queen)}},{key:"kingOf",value:function(e){return this.king.intersect(this[e]).diff(this.promoted).singleSquare()}}],[{key:"default",value:function(){var t=new e;return t.reset(),t}},{key:"racingKings",value:function(){var t=new e;return t.occupied=new s.SquareSet(65535,0),t.promoted=s.SquareSet.empty(),t.white=new s.SquareSet(61680,0),t.black=new s.SquareSet(3855,0),t.pawn=s.SquareSet.empty(),t.knight=new s.SquareSet(6168,0),t.bishop=new s.SquareSet(9252,0),t.rook=new s.SquareSet(16962,0),t.queen=new s.SquareSet(129,0),t.king=new s.SquareSet(33024,0),t}},{key:"horde",value:function(){var t=new e;return t.occupied=new s.SquareSet(4294967295,4294901862),t.promoted=s.SquareSet.empty(),t.white=new s.SquareSet(4294967295,102),t.black=new s.SquareSet(0,4294901760),t.pawn=new s.SquareSet(4294967295,16711782),t.knight=new s.SquareSet(0,1107296256),t.bishop=new s.SquareSet(0,603979776),t.rook=new s.SquareSet(0,2164260864),t.queen=new s.SquareSet(0,134217728),t.king=new s.SquareSet(0,268435456),t}},{key:"empty",value:function(){var t=new e;return t.clear(),t}}]),e}();t.Board=u},"22d3":function(e,t,n){"use strict";n("99af"),n("caad"),n("c975"),n("a15b"),n("d81d"),n("ac1f"),n("8a79"),n("2532"),n("38cf"),n("1276");var r=n("448a"),i=n("6374"),a=n("970b"),o=n("ed6d"),s=n("2d0d"),u=n("a128");Object.defineProperty(t,"__esModule",{value:!0}),t.makeFen=t.makeRemainingChecks=t.makeCastlingFen=t.makePockets=t.makePocket=t.makeBoardFen=t.makePiece=t.parsePiece=t.parseFen=t.parseRemainingChecks=t.parseCastlingFen=t.parsePockets=t.parseBoardFen=t.FenError=t.InvalidFen=t.EMPTY_FEN=t.EMPTY_EPD=t.EMPTY_BOARD_FEN=t.INITIAL_FEN=t.INITIAL_EPD=t.INITIAL_BOARD_FEN=void 0;var c,h=n("909b"),l=n("4467"),f=n("825c"),d=n("0a9d"),v=n("e27b"),k=n("987b");t.INITIAL_BOARD_FEN="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",t.INITIAL_EPD=t.INITIAL_BOARD_FEN+" w KQkq -",t.INITIAL_FEN=t.INITIAL_EPD+" 0 1",t.EMPTY_BOARD_FEN="8/8/8/8/8/8/8/8",t.EMPTY_EPD=t.EMPTY_BOARD_FEN+" w - -",t.EMPTY_FEN=t.EMPTY_EPD+" 0 1",function(e){e["Fen"]="ERR_FEN",e["Board"]="ERR_BOARD",e["Pockets"]="ERR_POCKETS",e["Turn"]="ERR_TURN",e["Castling"]="ERR_CASTLING",e["EpSquare"]="ERR_EP_SQUARE",e["RemainingChecks"]="ERR_REMAINING_CHECKS",e["Halfmoves"]="ERR_HALFMOVES",e["Fullmoves"]="ERR_FULLMOVES"}(c=t.InvalidFen||(t.InvalidFen={}));var p=function(e){o(n,e);var t=s(n);function n(){return a(this,n),t.apply(this,arguments)}return n}(u(Error));function m(e,t,n){var r=e.indexOf(t);while(n-- >0){if(-1===r)break;r=e.indexOf(t,r+t.length)}return r}function y(e){return/^\d{1,4}$/.test(e)?parseInt(e,10):void 0}function S(e){var t=k.charToRole(e);return t&&{role:t,color:e.toLowerCase()===e?"black":"white"}}function w(e){for(var t=d.Board.empty(),n=7,r=0,i=0;i<e.length;i++){var a=e[i];if("/"===a&&8===r)r=0,n--;else{var o=parseInt(a,10);if(o>0)r+=o;else{if(r>=8||n<0)return h.Result.err(new p(c.Board));var s=r+8*n,u=S(a);if(!u)return h.Result.err(new p(c.Board));"~"===e[i+1]&&(u.promoted=!0,i++),t.set(s,u),r++}}}return 0!==n||8!==r?h.Result.err(new p(c.Board)):h.Result.ok(t)}function b(e){if(e.length>64)return h.Result.err(new p(c.Pockets));var t,n=v.Material.empty(),r=i(e);try{for(r.s();!(t=r.n()).done;){var a=t.value,o=S(a);if(!o)return h.Result.err(new p(c.Pockets));n[o.color][o.role]++}}catch(s){r.e(s)}finally{r.f()}return h.Result.ok(n)}function g(e,t){var n=f.SquareSet.empty();if("-"===t)return h.Result.ok(n);if(!/^[KQABCDEFGH]{0,2}[kqabcdefgh]{0,2}$/.test(t))return h.Result.err(new p(c.Castling));var r,a=i(t);try{for(a.s();!(r=a.n()).done;){var o=r.value,s=o.toLowerCase(),u=o===s?"black":"white",l=f.SquareSet.backrank(u).intersect(e[u]),d=void 0;d="q"===s?l:"k"===s?l.reversed():f.SquareSet.fromSquare(s.charCodeAt(0)-"a".charCodeAt(0)).intersect(l);var v,k=i(d);try{for(k.s();!(v=k.n()).done;){var m=v.value;if(e.king.has(m)&&!e.promoted.has(m))break;if(e.rook.has(m)){n=n.with(m);break}}}catch(y){k.e(y)}finally{k.f()}}}catch(y){a.e(y)}finally{a.f()}return h.Result.ok(n)}function q(e){var t=e.split("+");if(3===t.length&&""===t[0]){var n=y(t[1]),r=y(t[2]);return!k.defined(n)||n>3||!k.defined(r)||r>3?h.Result.err(new p(c.RemainingChecks)):h.Result.ok(new v.RemainingChecks(3-n,3-r))}if(2===t.length){var i=y(t[0]),a=y(t[1]);return!k.defined(i)||i>3||!k.defined(a)||a>3?h.Result.err(new p(c.RemainingChecks)):h.Result.ok(new v.RemainingChecks(i,a))}return h.Result.err(new p(c.RemainingChecks))}function R(e){var t,n,r=e.split(" "),i=r.shift(),a=h.Result.ok(void 0);if(i.endsWith("]")){var o=i.indexOf("[");if(-1===o)return h.Result.err(new p(c.Fen));t=w(i.substr(0,o)),a=b(i.substr(o+1,i.length-1-o-1))}else{var s=m(i,"/",7);-1===s?t=w(i):(t=w(i.substr(0,s)),a=b(i.substr(s+1)))}var u=r.shift();if(k.defined(u)&&"w"!==u){if("b"!==u)return h.Result.err(new p(c.Turn));n="black"}else n="white";return t.chain((function(e){var t,i=r.shift(),o=k.defined(i)?g(e,i):h.Result.ok(f.SquareSet.empty()),s=r.shift();if(k.defined(s)&&"-"!==s&&(t=k.parseSquare(s),!k.defined(t)))return h.Result.err(new p(c.EpSquare));var u,l=r.shift();k.defined(l)&&l.includes("+")&&(u=q(l),l=r.shift());var d=k.defined(l)?y(l):0;if(!k.defined(d))return h.Result.err(new p(c.Halfmoves));var v=r.shift(),m=k.defined(v)?y(v):1;if(!k.defined(m))return h.Result.err(new p(c.Fullmoves));var S=r.shift(),w=h.Result.ok(void 0);if(k.defined(S)){if(k.defined(u))return h.Result.err(new p(c.RemainingChecks));w=q(S)}else k.defined(u)&&(w=u);return r.length>0?h.Result.err(new p(c.Fen)):a.chain((function(r){return o.chain((function(i){return w.map((function(a){return{board:e,pockets:r,turn:n,unmovedRooks:i,remainingChecks:a,epSquare:t,halfmoves:d,fullmoves:Math.max(1,m)}}))}))}))}))}function E(e){if(e){var t=S(e[0]);if(t){if(2===e.length&&"~"===e[1])t.promoted=!0;else if(e.length>1)return;return t}}}function P(e,t){var n=k.roleToChar(e.role);return"white"===e.color&&(n=n.toUpperCase()),(null===t||void 0===t?void 0:t.promoted)&&e.promoted&&(n+="~"),n}function C(e,t){for(var n="",r=0,i=7;i>=0;i--)for(var a=0;a<8;a++){var o=a+8*i,s=e.get(o);s?(r>0&&(n+=r,r=0),n+=P(s,t)):r++,7===a&&(r>0&&(n+=r,r=0),0!==i&&(n+="/"))}return n}function O(e){return l.ROLES.map((function(t){return k.roleToChar(t).repeat(e[t])})).join("")}function A(e){return O(e.white).toUpperCase()+O(e.black)}function _(e,t,n){var r,a=null===n||void 0===n?void 0:n.shredder,o="",s=i(l.COLORS);try{for(s.s();!(r=s.n()).done;){var u=r.value,c=f.SquareSet.backrank(u),h=e.kingOf(u);if(k.defined(h)&&c.has(h)){var d,v=e.pieces(u,"rook").intersect(c),p=i(t.intersect(v).reversed());try{for(p.s();!(d=p.n()).done;){var m=d.value;if(!a&&m===v.first()&&m<h)o+="white"===u?"Q":"q";else if(!a&&m===v.last()&&h<m)o+="white"===u?"K":"k";else{var y=l.FILE_NAMES[k.squareFile(m)];o+="white"===u?y.toUpperCase():y}}}catch(S){p.e(S)}finally{p.f()}}}}catch(S){s.e(S)}finally{s.f()}return o||"-"}function M(e){return"".concat(e.white,"+").concat(e.black)}function I(e,t){return[C(e.board,t)+(e.pockets?"[".concat(A(e.pockets),"]"):""),e.turn[0],_(e.board,e.unmovedRooks,t),k.defined(e.epSquare)?k.makeSquare(e.epSquare):"-"].concat(r(e.remainingChecks?[M(e.remainingChecks)]:[]),r((null===t||void 0===t?void 0:t.epd)?[]:[Math.max(0,Math.min(e.halfmoves,9999)),Math.max(1,Math.min(e.fullmoves,9999))])).join(" ")}t.FenError=p,t.parseBoardFen=w,t.parsePockets=b,t.parseCastlingFen=g,t.parseRemainingChecks=q,t.parseFen=R,t.parsePiece=E,t.makePiece=P,t.makeBoardFen=C,t.makePocket=O,t.makePockets=A,t.makeCastlingFen=_,t.makeRemainingChecks=M,t.makeFen=I},4467:function(e,t,n){"use strict";function r(e){return"role"in e}function i(e){return"from"in e}Object.defineProperty(t,"__esModule",{value:!0}),t.RULES=t.isNormal=t.isDrop=t.CASTLING_SIDES=t.ROLES=t.COLORS=t.RANK_NAMES=t.FILE_NAMES=void 0,t.FILE_NAMES=["a","b","c","d","e","f","g","h"],t.RANK_NAMES=["1","2","3","4","5","6","7","8"],t.COLORS=["white","black"],t.ROLES=["pawn","knight","bishop","rook","queen","king"],t.CASTLING_SIDES=["a","h"],t.isDrop=r,t.isNormal=i,t.RULES=["chess","antichess","kingofthehill","3check","atomic","horde","racingkings","crazyhouse"]},"56d7":function(e,t,n){"use strict";n.r(t);n("99af"),n("c740"),n("d3b7");var r=n("b85c"),i=(n("96cf"),n("1da1")),a=(n("e260"),n("e6cf"),n("cca6"),n("a79d"),n("2b0e")),o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("div",{staticClass:"score",attrs:{id:"score"}}),n("input",{staticStyle:{display:"none"},attrs:{type:"text",id:"fen"}}),n("button",{staticStyle:{display:"none"},attrs:{id:"clickbutton"},on:{click:function(t){return e.setFen()}}}),n("input",{staticStyle:{display:"none"},attrs:{type:"text",id:"showmove"}}),n("chessboard",{staticClass:"board",attrs:{fen:e.currentFen},on:{onMove:e.showMove}})],1)},s=[],u=n("66f9"),c=(n("1ec6"),{name:"app",components:{chessboard:u["chessboard"]},data:function(){return{currentFen:"",positionInfo:null}},methods:{showMove:function(e){var t=JSON.stringify(e);document.getElementById("showmove").value=t},setFen:function(e){var t=document.getElementById("fen");e&&(t.value=e),this.currentFen=t.value},promote:function(){return confirm("Want to promote to rook? Queen by default")?"r":"q"}},created:function(){this.fens=["5rr1/3nqpk1/p3p2p/Pp1pP1pP/2pP1PN1/2P1Q3/2P3P1/R4RK1 b - f3 0 28","r4rk1/pp1b3p/6p1/8/3NpP2/1P4P1/P2K3P/R6R w - - 0 22"]}}),h=c,l=n("2877"),f=Object(l["a"])(h,o,s,!1,null,null,null),d=f.exports,v=(n("ebed"),n("22d3")),k=n("fb26"),p=n("987b");new a["a"]({el:"#app",render:function(e){return e(d)}});var m="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";function y(e){var t=Object(v["parseFen"])(e).unwrap(),n=k["Chess"].fromSetup(t).unwrap();return n}function S(e){var t=Object(v["makeFen"])(e.toSetup(),null);return t}function w(e,t){var n=Object(p["parseUci"])(t);e.play(n)}var b=null;function g(e){document.getElementById("fen").value=e,document.getElementById("clickbutton").click(),b=y(e)}g(m);var q=document.getElementById("showmove");function R(){return new Promise((function(e){var t=q.value;setInterval((function(){q.value!=t&&e(JSON.parse(q.value))}),200)}))}function E(e){return new Promise((function(t){fetch("https://explorer.lichess.ovh/lichess?fen=".concat(e,"&play=&variant=standard&speeds%5B%5D=blitz&speeds%5B%5D=rapid&ratings%5B%5D=2000&ratings%5B%5D=2200&ratings%5B%5D=2500")).then((function(e){return e.json().then((function(e){t(e)}))}))}))}var P=0,C=0;function O(e){document.getElementById("score").innerHTML=e}function A(){return _.apply(this,arguments)}function _(){return _=Object(i["a"])(regeneratorRuntime.mark((function e(){var t,n,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=S(b),e.next=3,R();case 3:n=e.sent,i=n.history[0],b=y(n.fen),g(n.fen),E(t).then((function(e){var t=e.moves.findIndex((function(e){return e.san==i}));if(t<0)return window.alert("This move is not among top 12 choices. You lose. Lets start again ..."),g(m),P=0,O("Make your opening move!"),C=0,void setTimeout((function(){A()}),0);g(n.fen),P++;var a=12-t;C+=a,O('You made the move ranked <span class="rank">'.concat(t+1,'</span> . You receive <span class="bonus">').concat(a,'</span> points. Your score is <span class="standing">').concat(C,"</span> .")),P>=12?(window.alert("Well done! Your final score is ".concat(C," .")),O('Your final score is <span class="standing">'.concat(C,"</span> . Make your first move!")),g(m),P=0,O('Your final score is <span class="standing">'.concat(C,"</span> . Make your first move!")),C=0,setTimeout((function(){A()}),0)):E(S(b)).then((function(e){var t,n=0,i=Object(r["a"])(e.moves);try{for(i.s();!(t=i.n()).done;){var a=t.value;n+=a.white+a.draws+a.black}}catch(l){i.e(l)}finally{i.f()}var o=Math.floor(Math.random()*n);n=0;var s,u=null,c=Object(r["a"])(e.moves);try{for(c.s();!(s=c.n()).done;){var h=s.value;if(n+=h.white+h.draws+h.black,n>=o){u=h;break}}}catch(l){c.e(l)}finally{c.f()}w(b,u.uci),g(S(b)),setTimeout((function(){A()}),0)}))}));case 8:case"end":return e.stop()}}),e)}))),_.apply(this,arguments)}O("Welcome to Opening Trainer! Make your first move!"),setTimeout((function(){A()}),0)},"825c":function(e,t,n){"use strict";n("a4d3"),n("e01a"),n("d28b"),n("40d9"),n("bc01"),n("d3b7"),n("3ca3"),n("ddb0"),n("96cf");var r=n("970b"),i=n("5bc3");function a(e){return e-=e>>>1&1431655765,e=(858993459&e)+(e>>>2&858993459),Math.imul(e+(e>>>4)&252645135,16843009)>>24}function o(e){return e=e>>>8&16711935|(16711935&e)<<8,e>>>16&65535|(65535&e)<<16}function s(e){return e=e>>>1&1431655765|(1431655765&e)<<1,e=e>>>2&858993459|(858993459&e)<<2,e=e>>>4&252645135|(252645135&e)<<4,o(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.SquareSet=void 0;var u=function(){function e(t,n){r(this,e),this.lo=t,this.hi=n,this.lo=0|t,this.hi=0|n}return i(e,[{key:"complement",value:function(){return new e(~this.lo,~this.hi)}},{key:"xor",value:function(t){return new e(this.lo^t.lo,this.hi^t.hi)}},{key:"union",value:function(t){return new e(this.lo|t.lo,this.hi|t.hi)}},{key:"intersect",value:function(t){return new e(this.lo&t.lo,this.hi&t.hi)}},{key:"diff",value:function(t){return new e(this.lo&~t.lo,this.hi&~t.hi)}},{key:"intersects",value:function(e){return this.intersect(e).nonEmpty()}},{key:"isDisjoint",value:function(e){return this.intersect(e).isEmpty()}},{key:"supersetOf",value:function(e){return e.diff(this).isEmpty()}},{key:"subsetOf",value:function(e){return this.diff(e).isEmpty()}},{key:"shr64",value:function(t){return t>=64?e.empty():t>=32?new e(this.hi>>>t-32,0):t>0?new e(this.lo>>>t^this.hi<<32-t,this.hi>>>t):this}},{key:"shl64",value:function(t){return t>=64?e.empty():t>=32?new e(0,this.lo<<t-32):t>0?new e(this.lo<<t,this.hi<<t^this.lo>>>32-t):this}},{key:"bswap64",value:function(){return new e(o(this.hi),o(this.lo))}},{key:"rbit64",value:function(){return new e(s(this.hi),s(this.lo))}},{key:"minus64",value:function(t){var n=this.lo-t.lo,r=(n&t.lo&1)+(t.lo>>>1)+(n>>>1)>>>31;return new e(n,this.hi-(t.hi+r))}},{key:"equals",value:function(e){return this.lo===e.lo&&this.hi===e.hi}},{key:"size",value:function(){return a(this.lo)+a(this.hi)}},{key:"isEmpty",value:function(){return 0===this.lo&&0===this.hi}},{key:"nonEmpty",value:function(){return 0!==this.lo||0!==this.hi}},{key:"has",value:function(e){return 0!==(e>=32?this.hi&1<<e-32:this.lo&1<<e)}},{key:"set",value:function(e,t){return t?this.with(e):this.without(e)}},{key:"with",value:function(t){return t>=32?new e(this.lo,this.hi|1<<t-32):new e(this.lo|1<<t,this.hi)}},{key:"without",value:function(t){return t>=32?new e(this.lo,this.hi&~(1<<t-32)):new e(this.lo&~(1<<t),this.hi)}},{key:"toggle",value:function(t){return t>=32?new e(this.lo,this.hi^1<<t-32):new e(this.lo^1<<t,this.hi)}},{key:"last",value:function(){return 0!==this.hi?63-Math.clz32(this.hi):0!==this.lo?31-Math.clz32(this.lo):void 0}},{key:"first",value:function(){return 0!==this.lo?31-Math.clz32(this.lo&-this.lo):0!==this.hi?63-Math.clz32(this.hi&-this.hi):void 0}},{key:"withoutFirst",value:function(){return 0!==this.lo?new e(this.lo&this.lo-1,this.hi):new e(0,this.hi&this.hi-1)}},{key:"moreThanOne",value:function(){return 0!==this.hi&&0!==this.lo||0!==(this.lo&this.lo-1)||0!==(this.hi&this.hi-1)}},{key:"singleSquare",value:function(){return this.moreThanOne()?void 0:this.last()}},{key:"isSingleSquare",value:function(){return this.nonEmpty()&&!this.moreThanOne()}},{key:Symbol.iterator,value:regeneratorRuntime.mark((function e(){var t,n,r,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t=this.lo,n=this.hi;case 2:if(0===t){e.next=9;break}return r=31-Math.clz32(t&-t),t^=1<<r,e.next=7,r;case 7:e.next=2;break;case 9:if(0===n){e.next=16;break}return i=31-Math.clz32(n&-n),n^=1<<i,e.next=14,32+i;case 14:e.next=9;break;case 16:case"end":return e.stop()}}),e,this)}))},{key:"reversed",value:regeneratorRuntime.mark((function e(){var t,n,r,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t=this.lo,n=this.hi;case 2:if(0===n){e.next=9;break}return r=31-Math.clz32(n),n^=1<<r,e.next=7,32+r;case 7:e.next=2;break;case 9:if(0===t){e.next=16;break}return i=31-Math.clz32(t),t^=1<<i,e.next=14,i;case 14:e.next=9;break;case 16:case"end":return e.stop()}}),e,this)}))}],[{key:"fromSquare",value:function(t){return t>=32?new e(0,1<<t-32):new e(1<<t,0)}},{key:"fromRank",value:function(t){return new e(255,0).shl64(8*t)}},{key:"fromFile",value:function(t){return new e(16843009<<t,16843009<<t)}},{key:"empty",value:function(){return new e(0,0)}},{key:"full",value:function(){return new e(4294967295,4294967295)}},{key:"corners",value:function(){return new e(129,2164260864)}},{key:"center",value:function(){return new e(402653184,24)}},{key:"backranks",value:function(){return new e(255,4278190080)}},{key:"backrank",value:function(t){return"white"===t?new e(255,0):new e(0,4278190080)}},{key:"lightSquares",value:function(){return new e(1437226410,1437226410)}},{key:"darkSquares",value:function(){return new e(2857740885,2857740885)}}]),e}();t.SquareSet=u},"987b":function(e,t,n){"use strict";n("99af"),n("fb6a"),Object.defineProperty(t,"__esModule",{value:!0}),t.makeUci=t.parseUci=t.makeSquare=t.parseSquare=t.charToRole=t.roleToChar=t.squareFile=t.squareRank=t.opposite=t.defined=void 0;var r=n("4467");function i(e){return void 0!==e}function a(e){return"white"===e?"black":"white"}function o(e){return e>>3}function s(e){return 7&e}function u(e){switch(e){case"pawn":return"p";case"knight":return"n";case"bishop":return"b";case"rook":return"r";case"queen":return"q";case"king":return"k"}}function c(e){switch(e){case"P":case"p":return"pawn";case"N":case"n":return"knight";case"B":case"b":return"bishop";case"R":case"r":return"rook";case"Q":case"q":return"queen";case"K":case"k":return"king";default:return}}function h(e){if(2===e.length){var t=e.charCodeAt(0)-"a".charCodeAt(0),n=e.charCodeAt(1)-"1".charCodeAt(0);if(!(t<0||t>=8||n<0||n>=8))return t+8*n}}function l(e){return r.FILE_NAMES[s(e)]+r.RANK_NAMES[o(e)]}function f(e){if("@"===e[1]&&4===e.length){var t=c(e[0]),n=h(e.slice(2));if(t&&i(n))return{role:t,to:n}}else if(4===e.length||5===e.length){var r,a=h(e.slice(0,2)),o=h(e.slice(2,4));if(5===e.length&&(r=c(e[4]),!r))return;if(i(a)&&i(o))return{from:a,to:o,promotion:r}}}function d(e){return r.isDrop(e)?"".concat(u(e.role).toUpperCase(),"@").concat(l(e.to)):l(e.from)+l(e.to)+(e.promotion?u(e.promotion):"")}t.defined=i,t.opposite=a,t.squareRank=o,t.squareFile=s,t.roleToChar=u,t.charToRole=c,t.parseSquare=h,t.makeSquare=l,t.parseUci=f,t.makeUci=d},b2d1:function(e,t,n){"use strict";var r=n("6374");Object.defineProperty(t,"__esModule",{value:!0}),t.between=t.ray=t.attacks=t.queenAttacks=t.rookAttacks=t.bishopAttacks=t.pawnAttacks=t.knightAttacks=t.kingAttacks=void 0;var i=n("987b"),a=n("825c");function o(e,t){var n,o=a.SquareSet.empty(),s=r(t);try{for(s.s();!(n=s.n()).done;){var u=n.value,c=e+u;0<=c&&c<64&&Math.abs(i.squareFile(e)-i.squareFile(c))<=2&&(o=o.with(c))}}catch(h){s.e(h)}finally{s.f()}return o}function s(e){for(var t=[],n=0;n<64;n++)t[n]=e(n);return t}var u=s((function(e){return o(e,[-9,-8,-7,-1,1,7,8,9])})),c=s((function(e){return o(e,[-17,-15,-10,-6,6,10,15,17])})),h={white:s((function(e){return o(e,[7,9])})),black:s((function(e){return o(e,[-7,-9])}))};function l(e){return u[e]}function f(e){return c[e]}function d(e,t){return h[e][t]}t.kingAttacks=l,t.knightAttacks=f,t.pawnAttacks=d;var v=s((function(e){return a.SquareSet.fromFile(i.squareFile(e)).without(e)})),k=s((function(e){return a.SquareSet.fromRank(i.squareRank(e)).without(e)})),p=s((function(e){var t=new a.SquareSet(134480385,2151686160),n=8*(i.squareRank(e)-i.squareFile(e));return(n>=0?t.shl64(n):t.shr64(-n)).without(e)})),m=s((function(e){var t=new a.SquareSet(270549120,16909320),n=8*(i.squareRank(e)+i.squareFile(e)-7);return(n>=0?t.shl64(n):t.shr64(-n)).without(e)}));function y(e,t,n){var r=n.intersect(t),i=r.bswap64();return r=r.minus64(e),i=i.minus64(e.bswap64()),r.xor(i.bswap64()).intersect(t)}function S(e,t){return y(a.SquareSet.fromSquare(e),v[e],t)}function w(e,t){var n=k[e],r=t.intersect(n),i=r.rbit64();return r=r.minus64(a.SquareSet.fromSquare(e)),i=i.minus64(a.SquareSet.fromSquare(63-e)),r.xor(i.rbit64()).intersect(n)}function b(e,t){var n=a.SquareSet.fromSquare(e);return y(n,p[e],t).xor(y(n,m[e],t))}function g(e,t){return S(e,t).xor(w(e,t))}function q(e,t){return b(e,t).xor(g(e,t))}function R(e,t,n){switch(e.role){case"pawn":return d(e.color,t);case"knight":return f(t);case"bishop":return b(t,n);case"rook":return g(t,n);case"queen":return q(t,n);case"king":return l(t)}}function E(e,t){var n=a.SquareSet.fromSquare(t);return k[e].intersects(n)?k[e].with(e):m[e].intersects(n)?m[e].with(e):p[e].intersects(n)?p[e].with(e):v[e].intersects(n)?v[e].with(e):a.SquareSet.empty()}function P(e,t){return E(e,t).intersect(a.SquareSet.full().shl64(e).xor(a.SquareSet.full().shl64(t))).withoutFirst()}t.bishopAttacks=b,t.rookAttacks=g,t.queenAttacks=q,t.attacks=R,t.ray=E,t.between=P},e27b:function(e,t,n){"use strict";n("a623"),n("45fc");var r=n("6374"),i=n("970b"),a=n("5bc3");Object.defineProperty(t,"__esModule",{value:!0}),t.defaultSetup=t.RemainingChecks=t.Material=t.MaterialSide=void 0;var o=n("4467"),s=n("825c"),u=n("0a9d"),c=function(){function e(){i(this,e)}return a(e,[{key:"clone",value:function(){var t,n=new e,i=r(o.ROLES);try{for(i.s();!(t=i.n()).done;){var a=t.value;n[a]=this[a]}}catch(s){i.e(s)}finally{i.f()}return n}},{key:"equals",value:function(e){var t=this;return o.ROLES.every((function(n){return t[n]===e[n]}))}},{key:"add",value:function(t){var n,i=new e,a=r(o.ROLES);try{for(a.s();!(n=a.n()).done;){var s=n.value;i[s]=this[s]+t[s]}}catch(u){a.e(u)}finally{a.f()}return i}},{key:"nonEmpty",value:function(){var e=this;return o.ROLES.some((function(t){return e[t]>0}))}},{key:"isEmpty",value:function(){return!this.nonEmpty()}},{key:"hasPawns",value:function(){return this.pawn>0}},{key:"hasNonPawns",value:function(){return this.knight>0||this.bishop>0||this.rook>0||this.queen>0||this.king>0}},{key:"count",value:function(){return this.pawn+this.knight+this.bishop+this.rook+this.queen+this.king}}],[{key:"empty",value:function(){var t,n=new e,i=r(o.ROLES);try{for(i.s();!(t=i.n()).done;){var a=t.value;n[a]=0}}catch(s){i.e(s)}finally{i.f()}return n}},{key:"fromBoard",value:function(t,n){var i,a=new e,s=r(o.ROLES);try{for(s.s();!(i=s.n()).done;){var u=i.value;a[u]=t.pieces(n,u).size()}}catch(c){s.e(c)}finally{s.f()}return a}}]),e}();t.MaterialSide=c;var h=function(){function e(t,n){i(this,e),this.white=t,this.black=n}return a(e,[{key:"clone",value:function(){return new e(this.white.clone(),this.black.clone())}},{key:"equals",value:function(e){return this.white.equals(e.white)&&this.black.equals(e.black)}},{key:"add",value:function(t){return new e(this.white.add(t.white),this.black.add(t.black))}},{key:"count",value:function(){return this.white.count()+this.black.count()}},{key:"isEmpty",value:function(){return this.white.isEmpty()&&this.black.isEmpty()}},{key:"nonEmpty",value:function(){return!this.isEmpty()}},{key:"hasPawns",value:function(){return this.white.hasPawns()||this.black.hasPawns()}},{key:"hasNonPawns",value:function(){return this.white.hasNonPawns()||this.black.hasNonPawns()}}],[{key:"empty",value:function(){return new e(c.empty(),c.empty())}},{key:"fromBoard",value:function(t){return new e(c.fromBoard(t,"white"),c.fromBoard(t,"black"))}}]),e}();t.Material=h;var l=function(){function e(t,n){i(this,e),this.white=t,this.black=n}return a(e,[{key:"clone",value:function(){return new e(this.white,this.black)}},{key:"equals",value:function(e){return this.white===e.white&&this.black===e.black}}],[{key:"default",value:function(){return new e(3,3)}}]),e}();function f(){return{board:u.Board.default(),pockets:void 0,turn:"white",unmovedRooks:s.SquareSet.corners(),epSquare:void 0,remainingChecks:void 0,halfmoves:0,fullmoves:1}}t.RemainingChecks=l,t.defaultSetup=f},ebed:function(e,t,n){},fb26:function(e,t,n){"use strict";n("a623"),n("d81d"),n("4ec9"),n("d3b7"),n("3ca3"),n("ddb0");var r=n("8962"),i=n("36c6"),a=n("6374"),o=n("5bc3"),s=n("970b"),u=n("ed6d"),c=n("2d0d"),h=n("a128");Object.defineProperty(t,"__esModule",{value:!0}),t.Chess=t.Position=t.Castles=t.PositionError=t.IllegalSetup=void 0;var l,f=n("909b"),d=n("4467"),v=n("825c"),k=n("0a9d"),p=n("b2d1"),m=n("987b");(function(e){e["Empty"]="ERR_EMPTY",e["OppositeCheck"]="ERR_OPPOSITE_CHECK",e["ImpossibleCheck"]="ERR_IMPOSSIBLE_CHECK",e["PawnsOnBackrank"]="ERR_PAWNS_ON_BACKRANK",e["Kings"]="ERR_KINGS",e["Variant"]="ERR_VARIANT"})(l=t.IllegalSetup||(t.IllegalSetup={}));var y=function(e){u(n,e);var t=c(n);function n(){return s(this,n),t.apply(this,arguments)}return n}(h(Error));function S(e,t,n,r){return n[t].intersect(p.rookAttacks(e,r).intersect(n.rooksAndQueens()).union(p.bishopAttacks(e,r).intersect(n.bishopsAndQueens())).union(p.knightAttacks(e).intersect(n.knight)).union(p.kingAttacks(e).intersect(n.king)).union(p.pawnAttacks(m.opposite(t),e).intersect(n.pawn)))}function w(e,t){return"white"===e?"a"===t?2:6:"a"===t?58:62}function b(e,t){return"white"===e?"a"===t?3:5:"a"===t?59:61}t.PositionError=y;var g=function(){function e(){s(this,e)}return o(e,[{key:"clone",value:function(){var t=new e;return t.unmovedRooks=this.unmovedRooks,t.rook={white:{a:this.rook.white.a,h:this.rook.white.h},black:{a:this.rook.black.a,h:this.rook.black.h}},t.path={white:{a:this.path.white.a,h:this.path.white.h},black:{a:this.path.black.a,h:this.path.black.h}},t}},{key:"add",value:function(e,t,n,r){var i=w(e,t),a=b(e,t);this.unmovedRooks=this.unmovedRooks.with(r),this.rook[e][t]=r,this.path[e][t]=p.between(r,a).with(a).union(p.between(n,i).with(i)).without(n).without(r)}},{key:"discardRook",value:function(e){if(this.unmovedRooks.has(e)){this.unmovedRooks=this.unmovedRooks.without(e);var t,n=a(d.COLORS);try{for(n.s();!(t=n.n()).done;){var r,i=t.value,o=a(d.CASTLING_SIDES);try{for(o.s();!(r=o.n()).done;){var s=r.value;this.rook[i][s]===e&&(this.rook[i][s]=void 0)}}catch(u){o.e(u)}finally{o.f()}}}catch(u){n.e(u)}finally{n.f()}}}},{key:"discardSide",value:function(e){this.unmovedRooks=this.unmovedRooks.diff(v.SquareSet.backrank(e)),this.rook[e].a=void 0,this.rook[e].h=void 0}}],[{key:"default",value:function(){var t=new e;return t.unmovedRooks=v.SquareSet.corners(),t.rook={white:{a:0,h:7},black:{a:56,h:63}},t.path={white:{a:new v.SquareSet(14,0),h:new v.SquareSet(96,0)},black:{a:new v.SquareSet(0,234881024),h:new v.SquareSet(0,1610612736)}},t}},{key:"empty",value:function(){var t=new e;return t.unmovedRooks=v.SquareSet.empty(),t.rook={white:{a:void 0,h:void 0},black:{a:void 0,h:void 0}},t.path={white:{a:v.SquareSet.empty(),h:v.SquareSet.empty()},black:{a:v.SquareSet.empty(),h:v.SquareSet.empty()}},t}},{key:"fromSetup",value:function(t){var n,r=e.empty(),i=t.unmovedRooks.intersect(t.board.rook),o=a(d.COLORS);try{for(o.s();!(n=o.n()).done;){var s=n.value,u=v.SquareSet.backrank(s),c=t.board.kingOf(s);if(m.defined(c)&&u.has(c)){var h=i.intersect(t.board[s]).intersect(u),l=h.first();m.defined(l)&&l<c&&r.add(s,"a",c,l);var f=h.last();m.defined(f)&&c<f&&r.add(s,"h",c,f)}}}catch(k){o.e(k)}finally{o.f()}return r}}]),e}();t.Castles=g;var q=function(){function e(t){s(this,e),this.rules=t}return o(e,[{key:"kingAttackers",value:function(e,t,n){return S(e,t,this.board,n)}},{key:"dropDests",value:function(e){return v.SquareSet.empty()}},{key:"playCaptureAt",value:function(e,t){this.halfmoves=0,"rook"===t.role&&this.castles.discardRook(e),this.pockets&&this.pockets[m.opposite(t.color)][t.role]++}},{key:"ctx",value:function(){var e=this.isVariantEnd(),t=this.board.kingOf(this.turn);if(!m.defined(t))return{king:t,blockers:v.SquareSet.empty(),checkers:v.SquareSet.empty(),variantEnd:e,mustCapture:!1};var n,r=p.rookAttacks(t,v.SquareSet.empty()).intersect(this.board.rooksAndQueens()).union(p.bishopAttacks(t,v.SquareSet.empty()).intersect(this.board.bishopsAndQueens())).intersect(this.board[m.opposite(this.turn)]),i=v.SquareSet.empty(),o=a(r);try{for(o.s();!(n=o.n()).done;){var s=n.value,u=p.between(t,s).intersect(this.board.occupied);u.moreThanOne()||(i=i.union(u))}}catch(h){o.e(h)}finally{o.f()}var c=this.kingAttackers(t,m.opposite(this.turn),this.board.occupied);return{king:t,blockers:i,checkers:c,variantEnd:e,mustCapture:!1}}},{key:"clone",value:function(){var e,t,n=new this.constructor;return n.board=this.board.clone(),n.pockets=null===(e=this.pockets)||void 0===e?void 0:e.clone(),n.turn=this.turn,n.castles=this.castles.clone(),n.epSquare=this.epSquare,n.remainingChecks=null===(t=this.remainingChecks)||void 0===t?void 0:t.clone(),n.halfmoves=this.halfmoves,n.fullmoves=this.fullmoves,n}},{key:"equalsIgnoreMoves",value:function(e){var t,n;return this.rules===e.rules&&(this.pockets?this.board.equals(e.board):this.board.equalsIgnorePromoted(e.board))&&(e.pockets&&(null===(t=this.pockets)||void 0===t?void 0:t.equals(e.pockets))||!this.pockets&&!e.pockets)&&this.turn===e.turn&&this.castles.unmovedRooks.equals(e.castles.unmovedRooks)&&this.legalEpSquare()===e.legalEpSquare()&&(e.remainingChecks&&(null===(n=this.remainingChecks)||void 0===n?void 0:n.equals(e.remainingChecks))||!this.remainingChecks&&!e.remainingChecks)}},{key:"toSetup",value:function(){var e,t;return{board:this.board.clone(),pockets:null===(e=this.pockets)||void 0===e?void 0:e.clone(),turn:this.turn,unmovedRooks:this.castles.unmovedRooks,epSquare:this.legalEpSquare(),remainingChecks:null===(t=this.remainingChecks)||void 0===t?void 0:t.clone(),halfmoves:Math.min(this.halfmoves,150),fullmoves:Math.min(Math.max(this.fullmoves,1),9999)}}},{key:"isInsufficientMaterial",value:function(){var e=this;return d.COLORS.every((function(t){return e.hasInsufficientMaterial(t)}))}},{key:"hasDests",value:function(e){e=e||this.ctx();var t,n=a(this.board[this.turn]);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(this.dests(r,e).nonEmpty())return!0}}catch(i){n.e(i)}finally{n.f()}return this.dropDests(e).nonEmpty()}},{key:"isLegal",value:function(e,t){if(d.isDrop(e))return!(!this.pockets||this.pockets[this.turn][e.role]<=0)&&(("pawn"!==e.role||!v.SquareSet.backranks().has(e.to))&&this.dropDests(t).has(e.to));if("pawn"===e.promotion)return!1;if("king"===e.promotion&&"antichess"!==this.rules)return!1;if(!!e.promotion!==(this.board.pawn.has(e.from)&&v.SquareSet.backranks().has(e.to)))return!1;var n=this.dests(e.from,t);return n.has(e.to)||n.has(this.normalizeMove(e).to)}},{key:"isCheck",value:function(){var e=this.board.kingOf(this.turn);return m.defined(e)&&this.kingAttackers(e,m.opposite(this.turn),this.board.occupied).nonEmpty()}},{key:"isEnd",value:function(e){return!!(e?e.variantEnd:this.isVariantEnd())||(this.isInsufficientMaterial()||!this.hasDests(e))}},{key:"isCheckmate",value:function(e){return e=e||this.ctx(),!e.variantEnd&&e.checkers.nonEmpty()&&!this.hasDests(e)}},{key:"isStalemate",value:function(e){return e=e||this.ctx(),!e.variantEnd&&e.checkers.isEmpty()&&!this.hasDests(e)}},{key:"outcome",value:function(e){var t=this.variantOutcome(e);return t||(e=e||this.ctx(),this.isCheckmate(e)?{winner:m.opposite(this.turn)}:this.isInsufficientMaterial()||this.isStalemate(e)?{winner:void 0}:void 0)}},{key:"allDests",value:function(e){e=e||this.ctx();var t=new Map;if(e.variantEnd)return t;var n,r=a(this.board[this.turn]);try{for(r.s();!(n=r.n()).done;){var i=n.value;t.set(i,this.dests(i,e))}}catch(o){r.e(o)}finally{r.f()}return t}},{key:"castlingSide",value:function(e){if(!d.isDrop(e)){var t=e.to-e.from;if((2===Math.abs(t)||this.board[this.turn].has(e.to))&&this.board.king.has(e.from))return t>0?"h":"a"}}},{key:"normalizeMove",value:function(e){var t=this.castlingSide(e);if(!t)return e;var n=this.castles.rook[this.turn][t];return{from:e.from,to:m.defined(n)?n:e.to}}},{key:"play",value:function(e){var t=this.turn,n=this.epSquare,r=this.castlingSide(e);if(this.epSquare=void 0,this.halfmoves+=1,"black"===t&&(this.fullmoves+=1),this.turn=m.opposite(t),d.isDrop(e))this.board.set(e.to,{role:e.role,color:t}),this.pockets&&this.pockets[t][e.role]--,"pawn"===e.role&&(this.halfmoves=0);else{var i,a=this.board.take(e.from);if(!a)return;if("pawn"===a.role){this.halfmoves=0,e.to===n&&(i=this.board.take(e.to+("white"===t?-8:8)));var o=e.from-e.to;16===Math.abs(o)&&8<=e.from&&e.from<=55&&(this.epSquare=e.from+e.to>>1),e.promotion&&(a.role=e.promotion,a.promoted=!0)}else if("rook"===a.role)this.castles.discardRook(e.from);else if("king"===a.role){if(r){var s=this.castles.rook[t][r];if(m.defined(s)){var u=this.board.take(s);this.board.set(w(t,r),a),u&&this.board.set(b(t,r),u)}}if(this.castles.discardSide(t),r)return}var c=this.board.set(e.to,a)||i;c&&this.playCaptureAt(e.to,c)}}},{key:"legalEpSquare",value:function(e){if(m.defined(this.epSquare)){e=e||this.ctx();var t,n=this.board.pieces(this.turn,"pawn"),r=n.intersect(p.pawnAttacks(m.opposite(this.turn),this.epSquare)),i=a(r);try{for(i.s();!(t=i.n()).done;){var o=t.value;if(this.dests(o,e).has(this.epSquare))return this.epSquare}}catch(s){i.e(s)}finally{i.f()}}}}]),e}();t.Position=q;var R=function(e){u(n,e);var t=c(n);function n(e){return s(this,n),t.call(this,e||"chess")}return o(n,[{key:"clone",value:function(){return r(i(n.prototype),"clone",this).call(this)}},{key:"validate",value:function(){if(this.board.occupied.isEmpty())return f.Result.err(new y(l.Empty));if(2!==this.board.king.size())return f.Result.err(new y(l.Kings));if(!m.defined(this.board.kingOf(this.turn)))return f.Result.err(new y(l.Kings));var e=this.board.kingOf(m.opposite(this.turn));return m.defined(e)?this.kingAttackers(e,this.turn,this.board.occupied).nonEmpty()?f.Result.err(new y(l.OppositeCheck)):v.SquareSet.backranks().intersects(this.board.pawn)?f.Result.err(new y(l.PawnsOnBackrank)):this.validateCheckers():f.Result.err(new y(l.Kings))}},{key:"validateCheckers",value:function(){var e=this.board.kingOf(this.turn);if(m.defined(e)){var t=this.kingAttackers(e,m.opposite(this.turn),this.board.occupied);if(t.size()>2||2===t.size()&&p.ray(t.first(),t.last()).has(e))return f.Result.err(new y(l.ImpossibleCheck));if(m.defined(this.epSquare)){var n,r=a(t);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(p.ray(i,this.epSquare).has(e))return f.Result.err(new y(l.ImpossibleCheck))}}catch(o){r.e(o)}finally{r.f()}}}return f.Result.ok(void 0)}},{key:"validEpSquare",value:function(e){if(m.defined(e)){var t="white"===this.turn?5:2,n="white"===this.turn?8:-8;if(m.squareRank(e)===t&&!this.board.occupied.has(e+n)){var r=e-n;if(this.board.pawn.has(r)&&this.board[m.opposite(this.turn)].has(r))return e}}}},{key:"castlingDest",value:function(e,t){if(!m.defined(t.king)||t.checkers.nonEmpty())return v.SquareSet.empty();var n=this.castles.rook[this.turn][e];if(!m.defined(n))return v.SquareSet.empty();if(this.castles.path[this.turn][e].intersects(this.board.occupied))return v.SquareSet.empty();var r,i=w(this.turn,e),o=p.between(t.king,i),s=this.board.occupied.without(t.king),u=a(o);try{for(u.s();!(r=u.n()).done;){var c=r.value;if(this.kingAttackers(c,m.opposite(this.turn),s).nonEmpty())return v.SquareSet.empty()}}catch(f){u.e(f)}finally{u.f()}var h=b(this.turn,e),l=this.board.occupied.toggle(t.king).toggle(n).toggle(h);return this.kingAttackers(i,m.opposite(this.turn),l).nonEmpty()?v.SquareSet.empty():v.SquareSet.fromSquare(n)}},{key:"canCaptureEp",value:function(e,t){if(!m.defined(this.epSquare))return!1;if(!p.pawnAttacks(this.turn,e).has(this.epSquare))return!1;if(!m.defined(t.king))return!0;var n=this.epSquare+("white"===this.turn?-8:8),r=this.board.occupied.toggle(e).toggle(this.epSquare).toggle(n);return!this.kingAttackers(t.king,m.opposite(this.turn),r).intersects(r)}},{key:"pseudoDests",value:function(e,t){if(t.variantEnd)return v.SquareSet.empty();var n=this.board.get(e);if(!n||n.color!==this.turn)return v.SquareSet.empty();var r=p.attacks(n,e,this.board.occupied);if("pawn"===n.role){var i=this.board[m.opposite(this.turn)];m.defined(this.epSquare)&&(i=i.with(this.epSquare)),r=r.intersect(i);var a="white"===this.turn?8:-8,o=e+a;if(0<=o&&o<64&&!this.board.occupied.has(o)){r=r.with(o);var s="white"===this.turn?e<16:e>=48,u=o+a;s&&!this.board.occupied.has(u)&&(r=r.with(u))}return r}return r=r.diff(this.board[this.turn]),e===t.king?r.union(this.castlingDest("a",t)).union(this.castlingDest("h",t)):r}},{key:"dests",value:function(e,t){if(t=t||this.ctx(),t.variantEnd)return v.SquareSet.empty();var n,r,i=this.board.get(e);if(!i||i.color!==this.turn)return v.SquareSet.empty();if("pawn"===i.role){n=p.pawnAttacks(this.turn,e).intersect(this.board[m.opposite(this.turn)]);var o="white"===this.turn?8:-8,s=e+o;if(0<=s&&s<64&&!this.board.occupied.has(s)){n=n.with(s);var u="white"===this.turn?e<16:e>=48,c=s+o;u&&!this.board.occupied.has(c)&&(n=n.with(c))}if(m.defined(this.epSquare)&&this.canCaptureEp(e,t)){var h=this.epSquare-o;(t.checkers.isEmpty()||t.checkers.singleSquare()===h)&&(r=v.SquareSet.fromSquare(this.epSquare))}}else n="bishop"===i.role?p.bishopAttacks(e,this.board.occupied):"knight"===i.role?p.knightAttacks(e):"rook"===i.role?p.rookAttacks(e,this.board.occupied):"queen"===i.role?p.queenAttacks(e,this.board.occupied):p.kingAttacks(e);if(n=n.diff(this.board[this.turn]),m.defined(t.king)){if("king"===i.role){var l,f=this.board.occupied.without(e),d=a(n);try{for(d.s();!(l=d.n()).done;){var k=l.value;this.kingAttackers(k,m.opposite(this.turn),f).nonEmpty()&&(n=n.without(k))}}catch(S){d.e(S)}finally{d.f()}return n.union(this.castlingDest("a",t)).union(this.castlingDest("h",t))}if(t.checkers.nonEmpty()){var y=t.checkers.singleSquare();if(!m.defined(y))return v.SquareSet.empty();n=n.intersect(p.between(y,t.king).with(y))}t.blockers.has(e)&&(n=n.intersect(p.ray(e,t.king)))}return r&&(n=n.union(r)),n}},{key:"isVariantEnd",value:function(){return!1}},{key:"variantOutcome",value:function(e){}},{key:"hasInsufficientMaterial",value:function(e){if(this.board[e].intersect(this.board.pawn.union(this.board.rooksAndQueens())).nonEmpty())return!1;if(this.board[e].intersects(this.board.knight))return this.board[e].size()<=2&&this.board[m.opposite(e)].diff(this.board.king).diff(this.board.queen).isEmpty();if(this.board[e].intersects(this.board.bishop)){var t=!this.board.bishop.intersects(v.SquareSet.darkSquares())||!this.board.bishop.intersects(v.SquareSet.lightSquares());return t&&this.board.pawn.isEmpty()&&this.board.knight.isEmpty()}return!0}}],[{key:"default",value:function(){var e=new this;return e.board=k.Board.default(),e.pockets=void 0,e.turn="white",e.castles=g.default(),e.epSquare=void 0,e.remainingChecks=void 0,e.halfmoves=0,e.fullmoves=1,e}},{key:"fromSetup",value:function(e){var t=new this;return t.board=e.board.clone(),t.pockets=void 0,t.turn=e.turn,t.castles=g.fromSetup(e),t.epSquare=t.validEpSquare(e.epSquare),t.remainingChecks=void 0,t.halfmoves=e.halfmoves,t.fullmoves=e.fullmoves,t.validate().map((function(e){return t}))}}]),n}(q);t.Chess=R}});
//# sourceMappingURL=app.925c25a8.js.map